<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CBRN PRO</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden;
            background: #09090b; /* Zinc-950 */
            color: #ffffff;
        }
        
        /* –ö–ê–†–¢–ê –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù (z-index: 0) */
        #map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
        }
        
        /* GLASSMORPHISM - –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 80px;
            width: 380px;
            background: rgba(17, 24, 39, 0.85); /* Glassmorphism */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-right: 1px solid rgba(249, 115, 22, 0.2); /* Orange-500 —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        /* –•–µ–¥–µ—Ä —Å Glassmorphism */
        .app-header {
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            padding: 20px 24px;
            border-bottom: 2px solid #F97316; /* Orange-500 */
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .app-logo {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, #F97316 0%, #DC2626 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
        }
        
        .app-title {
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
            letter-spacing: 2px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
        }
        
        .app-title-sub {
            color: #F97316; /* Orange-500 */
        }
        
        /* –ö–ê–¢–ï–ì–û–†–ò–ò –£–ì–†–û–ó (CBRN) */
        .threat-tabs {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .threat-tab {
            background: rgba(30, 41, 59, 0.4); /* Slate-800 */
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #9ca3af; /* Gray-400 */
            font-weight: 700;
            font-size: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .threat-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .threat-tab:hover {
            background: rgba(51, 65, 85, 0.6); /* Slate-700 */
            border-color: rgba(249, 115, 22, 0.3);
            transform: translateX(4px);
        }
        
        .threat-tab:hover::before {
            opacity: 1;
        }
        
        .threat-tab.active {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #F97316; /* Orange-500 - –ì–†–ê–î–ò–ï–ù–¢–ù–ê–Ø –û–ë–í–û–î–ö–ê */
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            color: #ffffff;
            transform: translateX(4px);
        }
        
        .threat-tab.active::before {
            opacity: 1;
        }
        
        .threat-icon {
            font-size: 28px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(249, 115, 22, 0.1);
            flex-shrink: 0;
        }
        
        .threat-tab.active .threat-icon {
            background: rgba(249, 115, 22, 0.2);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏ */
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scrollbar-width: thin;
            scrollbar-color: #F97316 rgba(255, 255, 255, 0.05);
        }
        
        .panel-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .panel-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 4px;
        }
        
        .panel-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #F97316 0%, #DC2626 100%);
            border-radius: 4px;
        }
        
        .panel-content::-webkit-scrollbar-thumb:hover {
            background: #F97316;
        }
        
        /* –°–µ–∫—Ü–∏–∏ —Å Glassmorphism */
        .section {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 13px;
            font-weight: 800;
            color: #9ca3af; /* Gray-400 */
            text-transform: uppercase;
            margin-bottom: 16px;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* –ò–Ω–ø—É—Ç—ã –∏ —Å–µ–ª–µ–∫—Ç—ã - –ö–†–£–ü–ù–´–ï (Touch-friendly) */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            color: #9ca3af; /* Gray-400 */
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        
        .tactical-input, .tactical-select {
            width: 100%;
            background: rgba(15, 23, 42, 0.8); /* Slate-900 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px 16px;
            color: #ffffff;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tactical-input:focus, .tactical-select:focus {
            outline: none;
            border-color: #F97316; /* Orange-500 */
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.15);
            background: rgba(15, 23, 42, 0.95);
        }
        
        .tactical-select {
            cursor: pointer;
        }
        
        /* –°–ª–∞–π–¥–µ—Ä—ã - –ö–†–£–ü–ù–´–ï */
        .slider-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .tactical-slider {
            -webkit-appearance: none;
            appearance: none;
            flex: 1;
            height: 8px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 4px;
            outline: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tactical-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #F97316 0%, #DC2626 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s;
        }
        
        .tactical-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.7);
        }
        
        .tactical-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #F97316 0%, #DC2626 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .slider-value {
            min-width: 80px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 10px;
            padding: 10px 14px;
            text-align: center;
            color: #F97316;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ - –ö–†–£–ü–ù–´–ï (Touch-friendly) */
        .button-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .option-button {
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px 12px;
            color: #9ca3af; /* Gray-400 */
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option-button:hover {
            background: rgba(51, 65, 85, 0.7);
            border-color: rgba(249, 115, 22, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .option-button.active {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            border-color: #F97316; /* Orange-500 */
            color: #ffffff;
            box-shadow: 0 4px 16px rgba(249, 115, 22, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        /* INFO CARDS - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–ª–∞–≤–∞—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏) */
        .results-panel {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        }
        
        .result-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 14px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .result-item:hover {
            background: rgba(15, 23, 42, 0.9);
            border-color: rgba(249, 115, 22, 0.3);
            transform: translateX(4px);
        }
        
        .result-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .result-icon.orange {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3) 0%, rgba(234, 88, 12, 0.3) 100%);
            color: #F97316;
            border: 2px solid rgba(249, 115, 22, 0.4);
        }
        
        .result-icon.red {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.3) 0%, rgba(185, 28, 28, 0.3) 100%);
            color: #DC2626;
            border: 2px solid rgba(220, 38, 38, 0.4);
        }
        
        .result-info {
            flex: 1;
        }
        
        .result-label {
            font-size: 11px;
            color: #9ca3af; /* Gray-400 */
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .result-value {
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            line-height: 1;
        }
        
        /* BOTTOM NAVIGATION - –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å Glassmorphism */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 1001;
            box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.6);
            padding: 0 20px;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            padding: 12px 16px;
            color: #6b7280; /* Gray-500 */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            position: relative;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #F97316 0%, #DC2626 100%);
            border-radius: 2px 2px 0 0;
            transition: width 0.3s;
        }
        
        .nav-item:hover {
            color: #9ca3af; /* Gray-400 */
            background: rgba(249, 115, 22, 0.05);
        }
        
        .nav-item.active {
            color: #F97316; /* Orange-500 - –ê–ö–¢–ò–í–ù–´–ô –°–í–ï–¢–ò–¢–°–Ø –û–†–ê–ù–ñ–ï–í–´–ú */
            background: rgba(249, 115, 22, 0.1);
        }
        
        .nav-item.active::before {
            width: 60%;
        }
        
        .nav-icon {
            font-size: 28px;
            transition: transform 0.3s;
        }
        
        .nav-item.active .nav-icon {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(249, 115, 22, 0.6));
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å Glassmorphism */
        .toggle-sidebar {
            position: fixed;
            left: 390px;
            top: 24px;
            z-index: 1002;
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px;
            cursor: pointer;
            color: #F97316;
            font-size: 22px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toggle-sidebar.collapsed {
            left: 24px;
        }
        
        .toggle-sidebar:hover {
            background: rgba(17, 24, 39, 0.95);
            border-color: #F97316;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
        }
        
        /* INFO CARDS - –ü–ª–∞–≤–∞—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç—ã (–ø–æ–≥–æ–¥–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã) */
        .info-card {
            position: fixed;
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 900;
            transition: all 0.3s;
        }
        
        .info-card:hover {
            background: rgba(17, 24, 39, 0.95);
            border-color: rgba(249, 115, 22, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
        }
        
        .info-card-title {
            font-size: 11px;
            font-weight: 700;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .info-card-value {
            font-size: 20px;
            font-weight: 800;
            color: #ffffff;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
        }
        
        .info-card-icon {
            font-size: 24px;
            margin-right: 8px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                bottom: 80px;
            }
            
            .toggle-sidebar {
                left: auto;
                right: 24px;
            }
            
            .toggle-sidebar.collapsed {
                left: auto;
                right: 24px;
            }
            
            .bottom-nav {
                padding: 0 8px;
            }
            
            .nav-item {
                padding: 8px;
            }
            
            .nav-icon {
                font-size: 24px;
            }
            
            .nav-label {
                font-size: 10px;
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section {
            animation: fadeInUp 0.4s ease-out;
        }
        
        /* –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–ò (Toggle Switch) */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }
        
        .toggle-container:hover {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(249, 115, 22, 0.2);
        }
        
        .toggle-container.disabled {
            opacity: 0.5;
        }
        
        .toggle-label {
            font-size: 13px;
            font-weight: 600;
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .toggle-switch.active {
            background: linear-gradient(135deg, #F97316 0%, #DC2626 100%);
            border-color: #F97316;
            box-shadow: 0 0 12px rgba(249, 115, 22, 0.5);
        }
        
        .toggle-thumb {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: #ffffff;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .toggle-switch.active .toggle-thumb {
            transform: translateX(24px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // Isotoopide andmebaas (t√∂√∂stuslikud allikad)
        // radiationType: 'gamma', 'beta', 'alpha', 'mixed' - –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç –∑–æ–Ω!
        const isotopeDatabase = [
            { 
                name: "Co-60 (Kobolt-60)", 
                halfLife: "5.27 aastat", 
                dangerLevel: "K√µrge",
                description: "Gammadefektoskoopia, meditsiin",
                commonUse: "T√∂√∂stuslik radiograafia",
                radiationType: "gamma", // Inverse square law —Ä–∞–±–æ—Ç–∞–µ—Ç!
                maxRange: 10000 // –º–µ—Ç—Ä–æ–≤ (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–ª—è gamma)
            },
            { 
                name: "Cs-137 (Tseesium-137)", 
                halfLife: "30.17 aastat", 
                dangerLevel: "K√µrge",
                description: "Gammakiirgus, kontrollimisseadmed",
                commonUse: "T√∂√∂stuslikud m√µ√µteriistad",
                radiationType: "gamma",
                maxRange: 10000
            },
            { 
                name: "Ir-192 (Iriidium-192)", 
                halfLife: "73.83 p√§eva", 
                dangerLevel: "Keskmine",
                description: "Gammadefektoskoopia",
                commonUse: "Keevituste kontroll",
                radiationType: "gamma",
                maxRange: 10000
            },
            { 
                name: "Am-241 (Ameeritsium-241)", 
                halfLife: "432.2 aastat", 
                dangerLevel: "Keskmine",
                description: "Alfa-kiirgus, suitsuandurid",
                commonUse: "Tuleohutuse seadmed",
                radiationType: "alpha", // –ö–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–±–µ–≥!
                maxRange: 0.05 // –º–µ—Ç—Ä–æ–≤ (~5 —Å–º –≤ –≤–æ–∑–¥—É—Ö–µ)
            },
            { 
                name: "Sr-90 (Strontsium-90)", 
                halfLife: "28.79 aastat", 
                dangerLevel: "K√µrge",
                description: "Beeta-kiirgus",
                commonUse: "T√∂√∂stuslikud allikad",
                radiationType: "beta", // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø—Ä–æ–±–µ–≥
                maxRange: 10 // –º–µ—Ç—Ä–æ–≤ (~10 –º –≤ –≤–æ–∑–¥—É—Ö–µ)
            },
            { 
                name: "RDD (M√§√§ramatu segu)", 
                halfLife: "N/A", 
                dangerLevel: "Kriitiline",
                description: "M√§√§ramatu segu radionukliididest",
                commonUse: "Terroristlik r√ºnnak",
                radiationType: "mixed", // –°–º–µ—à–∞–Ω–Ω–æ–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º plume model!
                maxRange: 1000 // –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ç—Ä–∞
            }
        ];

        // Keemiliste ainete andmebaas (50 levinumat ainet)
        // density - –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –≤ –∫–≥/–ª (–¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π) –∏–ª–∏ –∫–≥/–º¬≥ –¥–ª—è –≥–∞–∑–æ–≤ (–ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö)
        // type: 'toxic' (AEGL) –∏–ª–∏ 'flammable' (LEL/UEL)
        // lel/uel - Lower/Upper Explosive Limit (ppm)
        // heatOfCombustion - —Ç–µ–ø–ª–æ—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è (–∫–î–∂/–∫–≥)
        // vaporPressure - –¥–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–≤ –ø—Ä–∏ 20¬∞C (mmHg) - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∏—Å–ø–∞—Ä–µ–Ω–∏—è!
        const chemicalDatabase = [
            { name: "Kloor", cas: "7782-50-5", appearance: "Roheline-kollane gaas", odor: "Terav, m√ºrgine", type: "toxic", idlh: 10, aegl1: 0.5, aegl2: 2.5, aegl3: 20, molWeight: 70.9, boilingPoint: -34, density: 0.0032, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 6800 },
            { name: "Ammoniaak", cas: "7664-41-7", appearance: "L√µhnatu gaas", odor: "Terav, s√∂√∂vitav", type: "toxic", idlh: 300, aegl1: 30, aegl2: 160, aegl3: 1100, molWeight: 17.03, boilingPoint: -33.3, density: 0.73, lel: 150000, uel: 280000, heatOfCombustion: 18600, vaporPressure: 8500 },
            { name: "Propaan", cas: "74-98-6", appearance: "L√µhnatu gaas", odor: "L√µhnatu (lisatud odorisant)", type: "flammable", idlh: 2100, aegl1: null, aegl2: null, aegl3: null, molWeight: 44.1, boilingPoint: -42.1, density: 0.51, lel: 21000, uel: 95000, heatOfCombustion: 46350, vaporPressure: 7500 },
            { name: "Metaan", cas: "74-82-8", appearance: "L√µhnatu gaas", odor: "L√µhnatu", type: "flammable", idlh: 1000, aegl1: null, aegl2: null, aegl3: null, molWeight: 16.04, boilingPoint: -161.5, density: 0.0007, lel: 50000, uel: 150000, heatOfCombustion: 50000, vaporPressure: 10000 },
            { name: "Eteen", cas: "74-85-1", appearance: "L√µhnatu gaas", odor: "L√µhnatu", type: "flammable", idlh: 800, aegl1: null, aegl2: null, aegl3: null, molWeight: 28.05, boilingPoint: -103.7, density: 0.57, lel: 27000, uel: 360000, heatOfCombustion: 47200, vaporPressure: 9000 },
            { name: "Vesinik", cas: "1333-74-0", appearance: "L√µhnatu gaas", odor: "L√µhnatu", type: "flammable", idlh: 4000, aegl1: null, aegl2: null, aegl3: null, molWeight: 2.016, boilingPoint: -252.9, density: 0.071, lel: 40000, uel: 750000, heatOfCombustion: 120000, vaporPressure: 10000 },
            { name: "Vesinikkloriid", cas: "7647-01-0", appearance: "L√µhnatu gaas", odor: "Terav, s√∂√∂vitav", type: "toxic", idlh: 50, aegl1: 2.7, aegl2: 50, aegl3: 150, molWeight: 36.46, boilingPoint: -85, density: 1.19, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 8000 },
            { name: "Vesinikfluoriid", cas: "7664-39-3", appearance: "L√µhnatu gaas", odor: "Terav", type: "toxic", idlh: 30, aegl1: 2, aegl2: 20, aegl3: 50, molWeight: 20.01, boilingPoint: 19.5, density: 0.99, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 760 },
            { name: "S√ºsinikmonooksiid", cas: "630-08-0", appearance: "L√µhnatu gaas", odor: "L√µhnatu", type: "toxic", idlh: 1200, aegl1: 200, aegl2: 400, aegl3: 800, molWeight: 28.01, boilingPoint: -191.5, density: 0.79, lel: 125000, uel: 740000, heatOfCombustion: 10100, vaporPressure: 10000 },
            { name: "S√ºsinikdioksiid", cas: "124-38-9", appearance: "L√µhnatu gaas", odor: "L√µhnatu", type: "toxic", idlh: 40000, aegl1: 17000, aegl2: 30000, aegl3: 40000, molWeight: 44.01, boilingPoint: -78.5, density: 0.77, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 10000 },
            { name: "Lahustunud kloor", cas: "7782-50-5", appearance: "Roheline-kollane gaas", odor: "Terav, m√ºrgine", type: "toxic", idlh: 10, aegl1: 0.5, aegl2: 2.5, aegl3: 20, molWeight: 70.9, boilingPoint: -34, density: 1.47, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 6800 },
            { name: "Fosgeen", cas: "75-44-5", appearance: "L√µhnatu gaas", odor: "L√µhnatu (m√ºrgine)", type: "toxic", idlh: 2, aegl1: 0.2, aegl2: 0.6, aegl3: 1.8, molWeight: 98.92, boilingPoint: 8.2, density: 1.37, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 1200 },
            { name: "S√ºsiniktetrakloriid", cas: "56-23-5", appearance: "L√µhnatu vedelik", odor: "Magus", type: "toxic", idlh: 200, aegl1: 2.5, aegl2: 8, aegl3: 25, molWeight: 153.82, boilingPoint: 76.7, density: 1.59, lel: null, uel: null, heatOfCombustion: 0, vaporPressure: 91 },
            { name: "Benseen", cas: "71-43-2", appearance: "L√µhnatu vedelik", odor: "Magus, aromaatne", idlh: 500, aegl1: 3.7, aegl2: 9.3, aegl3: 19, molWeight: 78.11, boilingPoint: 80.1, density: 0.88 },
            { name: "Tolueen", cas: "108-88-3", appearance: "L√µhnatu vedelik", odor: "Magus, aromaatne", idlh: 500, aegl1: 200, aegl2: 500, aegl3: 1000, molWeight: 92.14, boilingPoint: 110.6, density: 0.87 },
            { name: "Ksileen", cas: "1330-20-7", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 900, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 106.17, boilingPoint: 139, density: 0.86 },
            { name: "Etanool", cas: "64-17-5", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 3300, aegl1: 1000, aegl2: 5000, aegl3: 10000, molWeight: 46.07, boilingPoint: 78.4, density: 0.79 },
            { name: "Metanool", cas: "67-56-1", appearance: "L√µhnatu vedelik", odor: "L√µhnatu", idlh: 6000, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 32.04, boilingPoint: 64.7, density: 0.79 },
            { name: "Atsetoon", cas: "67-64-1", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 2500, aegl1: 500, aegl2: 2000, aegl3: 5000, molWeight: 58.08, boilingPoint: 56.1, density: 0.79 },
            { name: "Eteenoksiid", cas: "75-21-8", appearance: "L√µhnatu gaas", odor: "Magus", idlh: 800, aegl1: 0.5, aegl2: 2.5, aegl3: 10, molWeight: 44.05, boilingPoint: 10.7, density: 0.88 },
            { name: "Formaldeh√º√ºd", cas: "50-00-0", appearance: "L√µhnatu gaas", odor: "Terav, s√∂√∂vitav", idlh: 20, aegl1: 0.3, aegl2: 1, aegl3: 3, molWeight: 30.03, boilingPoint: -19, density: 0.82 },
            { name: "Atset√ºleen", cas: "74-86-2", appearance: "L√µhnatu gaas", odor: "L√µhnatu", idlh: 5000, aegl1: 2600, aegl2: 13000, aegl3: 26000, molWeight: 26.04, boilingPoint: -84, density: 0.62 },
            { name: "Butaan", cas: "106-97-8", appearance: "L√µhnatu gaas", odor: "L√µhnatu (lisatud odorisant)", type: "flammable", idlh: 1600, aegl1: null, aegl2: null, aegl3: null, molWeight: 58.12, boilingPoint: -0.5, density: 0.58, lel: 18000, uel: 85000, heatOfCombustion: 45720 },
            { name: "Pentaani", cas: "109-66-0", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 1500, aegl1: 2000, aegl2: 5000, aegl3: 10000, molWeight: 72.15, boilingPoint: 36.1, density: 0.63 },
            { name: "Heksaan", cas: "110-54-3", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 1100, aegl1: 2000, aegl2: 5000, aegl3: 10000, molWeight: 86.18, boilingPoint: 68.7, density: 0.66 },
            { name: "Ts√ºklopentaani", cas: "287-92-3", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 3000, aegl1: 2000, aegl2: 5000, aegl3: 10000, molWeight: 70.13, boilingPoint: 49.3, density: 0.75 },
            { name: "Diisoprop√º√ºlketoon", cas: "108-83-8", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 2000, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 100.16, boilingPoint: 124, density: 0.80 },
            { name: "Met√º√ºlisobut√º√ºlketoon", cas: "108-10-1", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 500, aegl1: 50, aegl2: 200, aegl3: 500, molWeight: 100.16, boilingPoint: 116.5, density: 0.80 },
            { name: "Eetilatsetaat", cas: "141-78-6", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 2000, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 88.11, boilingPoint: 77.1, density: 0.90 },
            { name: "Eetileeter", cas: "60-29-7", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 1900, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 74.12, boilingPoint: 34.6, density: 0.71 },
            { name: "Tetraet√º√ºlplii", cas: "78-00-2", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 40, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 323.44, boilingPoint: 200, density: 1.65 },
            { name: "Met√º√ºlmerkuri", cas: "22967-92-6", appearance: "L√µhnatu vedelik", odor: "L√µhnatu", idlh: 2, aegl1: 0.01, aegl2: 0.03, aegl3: 0.1, molWeight: 215.63, boilingPoint: 95, density: 3.07 },
            { name: "Arseen", cas: "7440-38-2", appearance: "Hall metall", odor: "L√µhnatu", idlh: 5, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 74.92, boilingPoint: 614, density: 5.73 },
            { name: "Kadmium", cas: "7440-43-9", appearance: "Hall metall", odor: "L√µhnatu", idlh: 9, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 112.41, boilingPoint: 767, density: 8.69 },
            { name: "Kroom", cas: "7440-47-3", appearance: "Hall metall", odor: "L√µhnatu", idlh: 15, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 52, boilingPoint: 2672, density: 7.19 },
            { name: "Nikkel", cas: "7440-02-0", appearance: "Hall metall", odor: "L√µhnatu", idlh: 10, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 58.69, boilingPoint: 2732, density: 8.91 },
            { name: "Plii", cas: "7439-92-1", appearance: "Hall metall", odor: "L√µhnatu", idlh: 100, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 207.2, boilingPoint: 1749, density: 11.34 },
            { name: "Tsink", cas: "7440-66-6", appearance: "Hall metall", odor: "L√µhnatu", idlh: 500, aegl1: 1, aegl2: 3, aegl3: 10, molWeight: 65.38, boilingPoint: 907, density: 7.14 },
            { name: "Vask", cas: "7440-50-8", appearance: "Punakas metall", odor: "L√µhnatu", idlh: 100, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 63.55, boilingPoint: 2562, density: 8.96 },
            { name: "Elavh√µbe", cas: "7439-97-6", appearance: "H√µbedane vedelik", odor: "L√µhnatu", idlh: 10, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 200.59, boilingPoint: 356.7, density: 13.53 },
            { name: "S√ºsiniktetrakloriid", cas: "56-23-5", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 200, aegl1: 2.5, aegl2: 8, aegl3: 25, molWeight: 153.82, boilingPoint: 76.7, density: 1.59 },
            { name: "Trichloroet√ºleen", cas: "79-01-6", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 1000, aegl1: 10, aegl2: 50, aegl3: 200, molWeight: 131.39, boilingPoint: 87.2, density: 1.46 },
            { name: "Perkloroet√ºleen", cas: "127-18-4", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 150, aegl1: 10, aegl2: 50, aegl3: 200, molWeight: 165.83, boilingPoint: 121.1, density: 1.62 },
            { name: "1,1,1-Trichloroetaan", cas: "71-55-6", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 1000, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 133.4, boilingPoint: 74.1, density: 1.34 },
            { name: "Met√ºleenkloriid", cas: "75-09-2", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 2300, aegl1: 200, aegl2: 1000, aegl3: 2000, molWeight: 97.94, boilingPoint: 39.8, density: 1.33 },
            { name: "Kloroform", cas: "67-66-3", appearance: "L√µhnatu vedelik", odor: "Magus", idlh: 500, aegl1: 10, aegl2: 50, aegl3: 200, molWeight: 121.38, boilingPoint: 61.2, density: 1.48 },
            { name: "Broom", cas: "7726-95-6", appearance: "Pruun vedelik", odor: "Terav, m√ºrgine", idlh: 3, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 159.8, boilingPoint: 58.8, density: 3.12 },
            { name: "Jood", cas: "7553-56-2", appearance: "Lilla tahke aine", odor: "Terav", idlh: 2, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 127.9, boilingPoint: 184.4, density: 4.93 },
            { name: "Fluor", cas: "7782-41-4", appearance: "Roheline-kollane gaas", odor: "Terav, m√ºrgine", idlh: 25, aegl1: 0.5, aegl2: 2.5, aegl3: 10, molWeight: 37.99, boilingPoint: -188.1, density: 0.0017 },
            { name: "V√§√§veldioksiid", cas: "7446-09-5", appearance: "L√µhnatu gaas", odor: "Terav, s√∂√∂vitav", idlh: 100, aegl1: 0.2, aegl2: 0.75, aegl3: 3, molWeight: 64.06, boilingPoint: -10, density: 1.43 },
            { name: "V√§√§veltrioksiid", cas: "7446-11-9", appearance: "L√µhnatu gaas", odor: "Terav, s√∂√∂vitav", idlh: 30, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 80.06, boilingPoint: 44.8, density: 1.92 },
            { name: "L√§mmastikdioksiid", cas: "10102-44-0", appearance: "Pruun gaas", odor: "Terav, s√∂√∂vitav", idlh: 20, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 46.01, boilingPoint: 21.2, density: 1.45 },
            { name: "L√§mmastikoksiid", cas: "10102-43-9", appearance: "L√µhnatu gaas", odor: "L√µhnatu", idlh: 25, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 44.01, boilingPoint: -151.8, density: 1.34 },
            { name: "Osoon", cas: "10028-15-6", appearance: "Sinine gaas", odor: "Terav", idlh: 5, aegl1: 0.1, aegl2: 0.3, aegl3: 1, molWeight: 48, boilingPoint: -111.9, density: 2.14 },
            { name: "Peroksiid", cas: "7722-84-1", appearance: "L√µhnatu vedelik", odor: "L√µhnatu", idlh: 75, aegl1: 0.5, aegl2: 2.5, aegl3: 10, molWeight: 34.01, boilingPoint: 150.2, density: 1.45 }
        ];

        // Matemaatilised funktsioonid
        const toRad = (v) => (v * Math.PI) / 180;
        const toDeg = (v) => (v * 180) / Math.PI;
        
        // Arvuta sihtpunkt kaugusel ja suunal
        const getDestination = (lat, lng, distKm, bearing) => {
            // Kontrolli sisendv√§√§rtusi
            if (!Number.isFinite(lat) || !Number.isFinite(lng) || !Number.isFinite(distKm) || !Number.isFinite(bearing)) {
                return null;
            }
            if (distKm < 0 || distKm > 10000) {
                return null;
            }
            
            try {
                const R = 6371; // Maa raadius km
                const brng = toRad(bearing);
                const lat1 = toRad(lat);
                const lon1 = toRad(lng);
                const lat2 = Math.asin(Math.sin(lat1) * Math.cos(distKm/R) + 
                                      Math.cos(lat1) * Math.sin(distKm/R) * Math.cos(brng));
                const lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(distKm/R) * Math.cos(lat1), 
                                              Math.cos(distKm/R) - Math.sin(lat1) * Math.sin(lat2));
                
                const result = [toDeg(lat2), toDeg(lon2)];
                
                // Kontrolli tulemusi
                if (!Number.isFinite(result[0]) || !Number.isFinite(result[1])) {
                    return null;
                }
                if (Math.abs(result[0]) > 90 || Math.abs(result[1]) > 180) {
                    return null;
                }
                
                return result;
            } catch (e) {
                console.error('Error in getDestination:', e);
                return null;
            }
        };

        // Loo pilve pol√ºgoon (ALOHA-p√µhine)
        function createPlumePolygon(center, lengthKm, windDir, stability) {
            // Kontrolli sisendv√§√§rtusi
            if (!center || !Number.isFinite(center.lat) || !Number.isFinite(center.lng)) {
                return null;
            }
            if (!Number.isFinite(lengthKm) || lengthKm <= 0 || lengthKm > 1000) {
                return null;
            }
            if (!Number.isFinite(windDir)) {
                windDir = 0;
            }
            
            const left = [], right = [];
            const steps = 50;
            
            // Pilve laius s√µltub stabiilsusest
            const stabWidth = { 
                inversion: 0.15,   // √ñ√∂ (stabiilne)
                neutral: 0.3,      // Pilves
                convection: 0.6     // P√§ev (ebastabiilne)
            };
            const wRatio = stabWidth[stability] || 0.3;

            try {
                for (let i = 0; i <= steps; i++) {
                    const d = (lengthKm / steps) * i;
                    if (d === 0 || !Number.isFinite(d)) {
                        right.push([center.lat, center.lng]);
                        left.push([center.lat, center.lng]);
                        continue;
                    }
                    
                    // Pilve laius suureneb kaugusega
                    let halfW = lengthKm * wRatio * Math.pow(d / lengthKm, 0.7) * Math.pow(1 - d / lengthKm, 0.3);
                    if (!Number.isFinite(halfW)) halfW = 0;
                    
                    const devAngle = toDeg(Math.atan2(halfW, d));
                    if (!Number.isFinite(devAngle)) continue;
                    
                    const hyp = Math.sqrt(d*d + halfW*halfW);
                    if (!Number.isFinite(hyp)) continue;
                    
                    const rightPoint = getDestination(center.lat, center.lng, hyp, windDir + devAngle);
                    const leftPoint = getDestination(center.lat, center.lng, hyp, windDir - devAngle);
                    
                    if (rightPoint && Number.isFinite(rightPoint[0]) && Number.isFinite(rightPoint[1])) {
                        right.push(rightPoint);
                    }
                    if (leftPoint && Number.isFinite(leftPoint[0]) && Number.isFinite(leftPoint[1])) {
                        left.push(leftPoint);
                    }
                }
                
                if (right.length < 3 || left.length < 3) {
                    return null;
                }
                
                return [...right, ...left.reverse()];
            } catch (e) {
                console.error('Error creating plume polygon:', e);
                return null;
            }
        }

        // === SOURCE TERM MODEL (—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –≤—ã–±—Ä–æ—Å–∞) ===
        // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞: CONTAINER –∏ PUDDLE
        function calculateSourceTerm(chemical, sourceMode, containerVolume, puddleArea, ambientTemperature, windSpeed, customPoolArea = null, continuousLeak = false) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if (!chemical || !Number.isFinite(chemical.density) || chemical.density <= 0) {
                return { rate: 0, scenario: 'unknown', warning: '', totalMass: 0, poolArea: 0, duration: 0 };
            }
            
            const T_amb = Number.isFinite(ambientTemperature) ? ambientTemperature : 20;
            const T_boil = Number.isFinite(chemical.boilingPoint) ? chemical.boilingPoint : -273;
            
            // === –†–ï–ñ–ò–ú 1: CONTAINER (–ï–º–∫–æ—Å—Ç—å/–¶–∏—Å—Ç–µ—Ä–Ω–∞) ===
            if (sourceMode === 'container') {
                // –®–ê–ì –ê: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—Å—É –≤–µ—â–µ—Å—Ç–≤–∞
                const totalMass = containerVolume * chemical.density; // –∫–≥
                
                // –®–ê–ì –ë: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≥—Ä–µ–≥–∞—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                let rate = 0; // kg/min
                let scenario = 'unknown';
                let warning = '';
                let calculatedPoolArea = 0;
                let duration = 0; // –º–∏–Ω—É—Ç—ã (—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç –¥–ª–∏—Ç—å—Å—è –≤—ã–±—Ä–æ—Å)
                
                if (T_amb > T_boil) {
                    // –°–¶–ï–ù–ê–†–ò–ô: –ì–ê–ó/–ö–ò–ü–ï–ù–ò–ï (Flash Boiling)
                    scenario = 'flash';
                    
                    if (continuousLeak) {
                        // –°—Ç—Ä—É–π–Ω–∞—è —É—Ç–µ—á–∫–∞: 10% –æ–±—ä–µ–º–∞ –≤ –º–∏–Ω—É—Ç—É
                        rate = totalMass * 0.1; // kg/min
                        duration = 10; // –º–∏–Ω—É—Ç –¥–æ –ø–æ–ª–Ω–æ–≥–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è
                        warning = `‚ö†Ô∏è CONTINUOUS LEAK (Gas Release)<br>–°—Ç—Ä—É–π–Ω–∞—è —É—Ç–µ—á–∫–∞: ${rate.toFixed(1)} kg/min<br>–í—Ä–µ–º—è –¥–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è: ${duration} –º–∏–Ω—É—Ç`;
                    } else {
                        // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤—ã–±—Ä–æ—Å: –≤—Å—ë –∑–∞ 10 –º–∏–Ω—É—Ç
                        rate = totalMass / 10; // kg/min
                        duration = 10;
                        warning = `‚ö†Ô∏è INSTANT RELEASE (Flash Boiling)<br>–í–µ—â–µ—Å—Ç–≤–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–∫–∏–ø–∞–µ—Ç –ø—Ä–∏ ${T_amb}¬∞C!<br>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∏–ø–µ–Ω–∏—è: ${T_boil}¬∞C`;
                    }
                    
                } else {
                    // –°–¶–ï–ù–ê–†–ò–ô: –ò–°–ü–ê–†–ï–ù–ò–ï –õ–£–ñ–ò (Pool Evaporation)
                    scenario = 'pool';
                    
                    // 1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–ª–æ—â–∞–¥—å –ª—É–∂–∏
                    let poolArea;
                    if (customPoolArea && Number.isFinite(customPoolArea) && customPoolArea > 0) {
                        poolArea = customPoolArea;
                    } else {
                        const volumeM3 = containerVolume / 1000; // L ‚Üí m¬≥
                        const poolDepth = 0.01; // m
                        poolArea = volumeM3 / poolDepth; // m¬≤
                        
                        // –î–ª—è —Å—Ç—Ä—É–π–Ω–æ–π —É—Ç–µ—á–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–ª–æ—â–∞–¥—å
                        if (continuousLeak) {
                            poolArea = Math.min(poolArea, 100); // –º–∞–∫—Å. 100 –º¬≤ –¥–ª—è –º–µ–ª–∫–∏—Ö —É—Ç–µ—á–µ–∫
                        }
                    }
                    calculatedPoolArea = poolArea;
                    
                    // 2. –§–∞–∫—Ç–æ—Ä –∏—Å–ø–∞—Ä–µ–Ω–∏—è
                    const tempDiff = T_amb - T_boil;
                    const evaporationFactor = Math.pow(2, tempDiff / 20);
                    
                    // 3. –§–∞–∫—Ç–æ—Ä –≤–µ—Ç—Ä–∞
                    const windFactor = 1 + (Number.isFinite(windSpeed) && windSpeed > 0 ? windSpeed / 10 : 0);
                    
                    // 4. –°–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø–∞—Ä–µ–Ω–∏—è
                    const baseEvapRate = 0.001; // kg/(m¬≤¬∑min)
                    rate = poolArea * baseEvapRate * evaporationFactor * windFactor;
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å
                    if (continuousLeak) {
                        // –î–ª—è —Å—Ç—Ä—É–π–Ω–æ–π —É—Ç–µ—á–∫–∏: –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–∏—Ç–æ–∫–æ–º (10%/–º–∏–Ω) –∏ –∏—Å–ø–∞—Ä–µ–Ω–∏–µ–º
                        const inflowRate = totalMass * 0.1; // kg/min –ø—Ä–∏—Ç–æ–∫
                        rate = Math.min(rate, inflowRate * 1.5); // –∏—Å–ø–∞—Ä–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ø—Ä–∏—Ç–æ–∫
                        duration = Math.ceil(totalMass / rate); // –º–∏–Ω—É—Ç—ã
                        warning = `üìä CONTINUOUS LEAK (Pool Evaporation)<br>–ü–ª–æ—â–∞–¥—å –ª—É–∂–∏: ${calculatedPoolArea.toFixed(1)} m¬≤<br>–°–∫–æ—Ä–æ—Å—Ç—å —É—Ç–µ—á–∫–∏: ${inflowRate.toFixed(2)} kg/min<br>–í—Ä–µ–º—è –¥–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è: ~${duration} –º–∏–Ω`;
                    } else {
                        // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–∞–∑–ª–∏–≤
                        rate = Math.min(rate, totalMass / 60); // –º–∞–∫—Å. –∑–∞ 60 –º–∏–Ω—É—Ç
                        duration = Math.ceil(totalMass / rate); // –º–∏–Ω—É—Ç—ã
                        warning = `üìä INSTANT SPILL (Pool Evaporation)<br>–ü–ª–æ—â–∞–¥—å –ª—É–∂–∏: ${calculatedPoolArea.toFixed(1)} m¬≤<br>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${T_amb}¬∞C (–∫–∏–ø–µ–Ω–∏–µ: ${T_boil}¬∞C)<br>–í—Ä–µ–º—è –∏—Å–ø–∞—Ä–µ–Ω–∏—è: ~${duration} –º–∏–Ω`;
                    }
                }
                
                return {
                    rate: Number.isFinite(rate) && rate > 0 ? rate : 0,
                    scenario: scenario,
                    warning: warning,
                    totalMass: totalMass,
                    poolArea: calculatedPoolArea,
                    duration: duration
                };
            }
            
            // === –†–ï–ñ–ò–ú 2: PUDDLE (–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª—É–∂–∞) ===
            else if (sourceMode === 'puddle') {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–õ–¨–ö–û –∑–∞–¥–∞–Ω–Ω—É—é –ø–ª–æ—â–∞–¥—å, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ–±—ä–µ–º
                const poolArea = puddleArea;
                
                if (!Number.isFinite(poolArea) || poolArea <= 0) {
                    return { rate: 0, scenario: 'unknown', warning: '–í–≤–µ–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å –ª—É–∂–∏!', totalMass: 0, poolArea: 0, duration: 0 };
                }
                
                // –û—Ü–µ–Ω–∏–≤–∞–µ–º –º–∞—Å—Å—É –≤–µ—â–µ—Å—Ç–≤–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –≥–ª—É–±–∏–Ω—É 1 —Å–º)
                const estimatedVolume = poolArea * 0.01; // m¬≥
                const totalMass = estimatedVolume * 1000 * chemical.density; // –∫–≥
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                let rate = 0;
                let scenario = 'pool'; // –õ—É–∂–∞ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–∞—Ä—è–µ—Ç—Å—è
                let warning = '';
                let duration = 0;
                
                if (T_amb > T_boil) {
                    // –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–∞—Ä–µ–Ω–∏–µ (–≤–µ—â–µ—Å—Ç–≤–æ –∫–∏–ø–∏—Ç)
                    const evaporationFactor = Math.pow(2, (T_amb - T_boil) / 10); // —É—Å–∏–ª–µ–Ω–Ω–æ–µ –∏—Å–ø–∞—Ä–µ–Ω–∏–µ
                    const windFactor = 1 + (Number.isFinite(windSpeed) && windSpeed > 0 ? windSpeed / 10 : 0);
                    const baseEvapRate = 0.002; // —É–¥–≤–æ–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –∫–∏–ø—è—â–µ–π –∂–∏–¥–∫–æ—Å—Ç–∏
                    rate = poolArea * baseEvapRate * evaporationFactor * windFactor;
                    duration = Math.ceil(totalMass / rate);
                    warning = `‚ö†Ô∏è EXISTING PUDDLE (Boiling)<br>–ü–ª–æ—â–∞–¥—å: ${poolArea.toFixed(1)} m¬≤<br>–í–µ—â–µ—Å—Ç–≤–æ –∫–∏–ø–∏—Ç! –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–∞—Ä–µ–Ω–∏–µ.<br>–í—Ä–µ–º—è –∏—Å–ø–∞—Ä–µ–Ω–∏—è: ~${duration} –º–∏–Ω`;
                } else {
                    // –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–∞—Ä–µ–Ω–∏–µ
                    const tempDiff = T_amb - T_boil;
                    const evaporationFactor = Math.pow(2, tempDiff / 20);
                    const windFactor = 1 + (Number.isFinite(windSpeed) && windSpeed > 0 ? windSpeed / 10 : 0);
                    const baseEvapRate = 0.001;
                    rate = poolArea * baseEvapRate * evaporationFactor * windFactor;
                    duration = Math.ceil(totalMass / rate);
                    warning = `üìä EXISTING PUDDLE (Evaporating)<br>–ü–ª–æ—â–∞–¥—å: ${poolArea.toFixed(1)} m¬≤<br>–û—Ü–µ–Ω–æ—á–Ω–∞—è –º–∞—Å—Å–∞: ${totalMass.toFixed(0)} –∫–≥ (–≥–ª—É–±–∏–Ω–∞ ~1—Å–º)<br>–í—Ä–µ–º—è –∏—Å–ø–∞—Ä–µ–Ω–∏—è: ~${duration} –º–∏–Ω`;
                }
                
                return {
                    rate: Number.isFinite(rate) && rate > 0 ? rate : 0,
                    scenario: scenario,
                    warning: warning,
                    totalMass: totalMass,
                    poolArea: poolArea,
                    duration: duration
                };
            }
            
            // Fallback
            return { rate: 0, scenario: 'unknown', warning: '', totalMass: 0, poolArea: 0, duration: 0 };
        }

        // Arvuta tsoonide kaugused (ALOHA-p√µhine)
        // Toetab nii TOXIC (AEGL) kui ka FLAMMABLE (LEL) aineid
        function calculateZones(chemical, releaseRate, windSpeed, stability) {
            // Kontrolli sisendv√§√§rtusi
            if (!chemical || !Number.isFinite(releaseRate) || releaseRate <= 0) {
                return { danger: 0, security: 0, clean: 0, zoneType: 'toxic' };
            }
            if (!Number.isFinite(windSpeed) || windSpeed <= 0) {
                windSpeed = 0.1; // V√§ltida nulliga jagamist
            }
            
            try {
                // Stabiilsuse tegur
                const stabF = { 
                    inversion: 3.0,    // √ñ√∂ - v√§hem hajumist
                    neutral: 1.0,      // Pilves - keskmine
                    convection: 0.3    // P√§ev - rohkem hajumist
                };
                const factor = stabF[stability] || 1.0;
                
                // === FLAMMABLE LOGIC (LEL-based) ===
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –≤–µ—â–µ—Å—Ç–≤–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'toxic' –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω)
                const chemType = chemical.type || 'toxic';
                if (chemType === 'flammable' && chemical.lel && chemical.molWeight) {
                    // –ü–†–ê–í–ò–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢: –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º LEL –∏–∑ ppm –≤ mg/m¬≥
                    // –§–æ—Ä–º—É–ª–∞: C(mg/m¬≥) = C(ppm) √ó MW / 24.45
                    // –≥–¥–µ 24.45 = –º–æ–ª—å–Ω—ã–π –æ–±—ä–µ–º –≥–∞–∑–∞ –ø—Ä–∏ 25¬∞C, 1 –∞—Ç–º (–ª–∏—Ç—Ä—ã)
                    
                    const lelPpm = chemical.lel;  // ppm (–Ω–∞–ø—Ä–∏–º–µ—Ä, 21000 –¥–ª—è –ø—Ä–æ–ø–∞–Ω–∞)
                    const lelMgM3 = (lelPpm / 1000000) * (chemical.molWeight / 24.45) * 1000000; // mg/m¬≥
                    
                    const lelSafetyPpm = lelPpm * 0.1; // 10% –æ—Ç LEL
                    const lelSafetyMgM3 = (lelSafetyPpm / 1000000) * (chemical.molWeight / 24.45) * 1000000; // mg/m¬≥
                    
                    // –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
                    // releaseRate –≤ kg/min = 1000 g/min
                    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ AEGL)
                    
                    // Flash Fire Zone (>= LEL) - –ö–†–ê–°–ù–ê–Ø
                    const distFlashFire = 0.1 * factor * Math.sqrt(releaseRate * 1000 / lelMgM3); // kg/min ‚Üí g/min
                    
                    // Safety Buffer Zone (>= 10% LEL) - –û–†–ê–ù–ñ–ï–í–ê–Ø
                    const distSafety = 0.1 * factor * Math.sqrt(releaseRate * 1000 / lelSafetyMgM3);
                    
                    const result = {
                        danger: Number.isFinite(distFlashFire) && distFlashFire > 0 ? Math.min(100, Math.max(0.01, distFlashFire)) : 0,
                        security: Number.isFinite(distSafety) && distSafety > 0 ? Math.min(100, Math.max(0.01, distSafety)) : 0,
                        clean: 0, // –î–ª—è flammable –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º 3-—é –∑–æ–Ω—É
                        zoneType: 'flammable'
                    };
                    
                    return result;
                }
                
                // === TOXIC LOGIC (AEGL-based) === (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
                if (!Number.isFinite(chemical.aegl1) || chemical.aegl1 <= 0 ||
                    !Number.isFinite(chemical.aegl2) || chemical.aegl2 <= 0 ||
                    !Number.isFinite(chemical.aegl3) || chemical.aegl3 <= 0) {
                    return { danger: 0, security: 0, clean: 0, zoneType: 'toxic' };
                }
                
                // Arvuta kaugused (kilomeetrites)
                // Lihtsustatud ALOHA valem: dist = k * sqrt(amount / threshold)
                const distRed = 0.1 * factor * Math.sqrt(releaseRate / chemical.aegl3);      // AEGL-3 (ohuala)
                const distOrange = 0.1 * factor * Math.sqrt(releaseRate / chemical.aegl2);  // AEGL-2 (julgestusala)
                const distGreen = 0.1 * factor * Math.sqrt(releaseRate / chemical.aegl1);   // AEGL-1 (puhas ala)
                
                // Kontrolli tulemusi
                const result = {
                    danger: Number.isFinite(distRed) && distRed > 0 ? Math.min(100, Math.max(0.01, distRed)) : 0,
                    security: Number.isFinite(distOrange) && distOrange > 0 ? Math.min(100, Math.max(0.01, distOrange)) : 0,
                    clean: Number.isFinite(distGreen) && distGreen > 0 ? Math.min(100, Math.max(0.01, distGreen)) : 0,
                    zoneType: 'toxic'
                };
                
                return result;
            } catch (e) {
                console.error('Error calculating zones:', e);
                return { danger: 0, security: 0, clean: 0, zoneType: 'toxic' };
            }
        }

        // BLEVE / FIREBALL —Ä–∞—Å—á–µ—Ç (–¥–ª—è –≥–æ—Ä—è—â–∏—Ö —Ü–∏—Å—Ç–µ—Ä–Ω)
        // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–¥–∏—É—Å—ã —Ç–µ–ø–ª–æ–≤—ã—Ö –∑–æ–Ω –≤ –º–µ—Ç—Ä–∞—Ö
        function calculateFireballZones(mass, heatOfCombustion) {
            // mass - –º–∞—Å—Å–∞ –≤–µ—â–µ—Å—Ç–≤–∞ –≤ –∫–≥
            // heatOfCombustion - —Ç–µ–ø–ª–æ—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è –≤ –∫–î–∂/–∫–≥
            
            if (!Number.isFinite(mass) || mass <= 0 || !Number.isFinite(heatOfCombustion) || heatOfCombustion <= 0) {
                return { fireball: 0, secondDegree: 0, thermal: 0 };
            }
            
            try {
                // 1. –†–∞–¥–∏—É—Å –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞ (Fireball Radius)
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: R = k * M^(1/3), –≥–¥–µ k ‚âà 5-6 –¥–ª—è —É–≥–ª–µ–≤–æ–¥–æ—Ä–æ–¥–æ–≤
                const fireballRadius = 5.8 * Math.pow(mass, 1/3); // –º–µ—Ç—Ä–æ–≤
                
                // 2. –¢–µ–ø–ª–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è (Total Heat Release)
                const totalHeat = mass * heatOfCombustion; // –∫–î–∂
                
                // 3. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏–∑–ª—É—á–µ–Ω–∏—è (Thermal Flux)
                // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ 30-40% —ç–Ω–µ—Ä–≥–∏–∏ –∏–¥–µ—Ç –≤ –∏–∑–ª—É—á–µ–Ω–∏–µ
                const radiatedEnergy = totalHeat * 0.35; // –∫–î–∂
                
                // 4. –ó–æ–Ω—ã —Ç–µ–ø–ª–æ–≤–æ–≥–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
                // –†–∞—Å—á–µ—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ: I = Q / (4 * œÄ * R¬≤), –≥–¥–µ I - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (–∫–í—Ç/–º¬≤)
                
                // –ó–û–ù–ê 1: –°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ (>37.5 –∫–í—Ç/–º¬≤ - 100% —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å –∑–∞ 10 —Å–µ–∫)
                // –£–ø—Ä–æ—â–µ–Ω–Ω–æ: —Ä–∞–¥–∏—É—Å –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞
                const lethalZone = fireballRadius;
                
                // –ó–û–ù–ê 2: –û–∂–æ–≥–∏ 2-3 —Å—Ç–µ–ø–µ–Ω–∏ (12.5 –∫–í—Ç/–º¬≤ - —Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ–∂–æ–≥–∏ –∑–∞ 30-60 —Å–µ–∫)
                // I = radiatedEnergy / (4 * œÄ * R¬≤) => R = sqrt(radiatedEnergy / (4 * œÄ * I))
                const targetFlux2 = 12.5; // –∫–í—Ç/–º¬≤
                const secondDegreeRadius = Math.sqrt((radiatedEnergy / 60) / (4 * Math.PI * targetFlux2)); // –î–µ–ª–µ–Ω–∏–µ –Ω–∞ 60 –¥–ª—è —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≥–æ—Ä–µ–Ω–∏—è
                
                // –ó–û–ù–ê 3: –ë–æ–ª–µ–≤–æ–π –ø–æ—Ä–æ–≥ (4 –∫–í—Ç/–º¬≤ - –±–æ–ª—å —á–µ—Ä–µ–∑ 20-30 —Å–µ–∫)
                const targetFlux3 = 4; // –∫–í—Ç/–º¬≤
                const thermalRadius = Math.sqrt((radiatedEnergy / 60) / (4 * Math.PI * targetFlux3));
                
                const result = {
                    fireball: Number.isFinite(lethalZone) && lethalZone > 0 ? Math.min(5000, lethalZone) : 0,
                    secondDegree: Number.isFinite(secondDegreeRadius) && secondDegreeRadius > 0 ? Math.min(5000, secondDegreeRadius) : 0,
                    thermal: Number.isFinite(thermalRadius) && thermalRadius > 0 ? Math.min(5000, thermalRadius) : 0
                };
                
                return result;
            } catch (e) {
                console.error('Error calculating fireball:', e);
                return { fireball: 0, secondDegree: 0, thermal: 0 };
            }
        }

        // Kiirgusmoodul - p√∂√∂rdruutude seadus
        function calculateDoseRate(initialDoseRate, initialDistance, newDistance) {
            // Kontrolli sisendv√§√§rtusi
            if (!Number.isFinite(initialDoseRate) || initialDoseRate <= 0) {
                return 0;
            }
            if (!Number.isFinite(initialDistance) || initialDistance <= 0) {
                return 0;
            }
            if (!Number.isFinite(newDistance) || newDistance <= 0) {
                return Infinity;
            }
            
            try {
                const result = initialDoseRate * Math.pow(initialDistance / newDistance, 2);
                return Number.isFinite(result) ? result : 0;
            } catch (e) {
                console.error('Error calculating dose rate:', e);
                return 0;
            }
        }

        // STAY TIME arvutus
        function calculateStayTime(doseRate, limit) {
            // Kontrolli sisendv√§√§rtusi
            if (!Number.isFinite(doseRate) || doseRate <= 0) {
                return Infinity;
            }
            if (!Number.isFinite(limit) || limit <= 0) {
                return Infinity;
            }
            
            try {
                const timeHours = limit / doseRate;
                if (!Number.isFinite(timeHours)) {
                    return Infinity;
                }
                return Math.max(0, Math.floor(timeHours * 60)); // minutites
            } catch (e) {
                console.error('Error calculating stay time:', e);
                return Infinity;
            }
        }

        // Arvuta kiirgusperimeetrid (IAEA standardid)
        // Sisend: M√µ√µdetud doosikiirus (¬µSv/h), kaugus (m), isotoop
        function calculateRadiationPerimetersIAEA(measuredDoseRate, measuredDistance, isotope) {
            // Kontrolli sisendv√§√§rtusi
            if (!Number.isFinite(measuredDoseRate) || measuredDoseRate <= 0) {
                return { innerCordon: 0, criticalZone: 0 };
            }
            if (!Number.isFinite(measuredDistance) || measuredDistance <= 0) {
                return { innerCordon: 0, criticalZone: 0 };
            }
            
            try {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∏–∑–ª—É—á–µ–Ω–∏—è
                const radiationType = isotope?.radiationType || 'gamma';
                const maxRange = isotope?.maxRange || 10000;
                
                // P√∂√∂rdruutude seadus: D1 * R1^2 = D2 * R2^2
                // R2 = sqrt((D1 * R1^2) / D2)
                const constantK = measuredDoseRate * (measuredDistance * measuredDistance);
                
                // 1. SISEMINE OTSELUS (Inner Cordon / Safety Perimeter)
                // IAEA standard: 100 ¬µSv/h
                const innerCordonLimit = 100; // ¬µSv/h
                let innerCordonDistance = Math.sqrt(constantK / innerCordonLimit);
                
                // 2. KRITILINE TSOON (Turn-back value / Critical Zone)
                // IAEA standard elu p√§√§stmiseks: 100 mSv/h = 100,000 ¬µSv/h
                const criticalZoneLimit = 100000; // ¬µSv/h (100 mSv/h)
                let criticalZoneDistance = Math.sqrt(constantK / criticalZoneLimit);
                
                // –£–ß–ï–¢ –¢–ò–ü–ê –ò–ó–õ–£–ß–ï–ù–ò–Ø:
                // Beta/Alpha –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø—Ä–æ–±–µ–≥ –≤ –≤–æ–∑–¥—É—Ö–µ!
                if (radiationType === 'beta' || radiationType === 'alpha') {
                    innerCordonDistance = Math.min(innerCordonDistance, maxRange);
                    criticalZoneDistance = Math.min(criticalZoneDistance, maxRange);
                }
                
                // Kontrolli tulemusi
                return {
                    innerCordon: Number.isFinite(innerCordonDistance) && innerCordonDistance > 0 
                        ? Math.min(maxRange, innerCordonDistance) : 0,
                    criticalZone: Number.isFinite(criticalZoneDistance) && criticalZoneDistance > 0 
                        ? Math.min(maxRange, criticalZoneDistance) : 0,
                    radiationType: radiationType // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–∏–ø –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                };
            } catch (e) {
                console.error('Error calculating IAEA radiation perimeters:', e);
                return { innerCordon: 0, criticalZone: 0, radiationType: 'gamma' };
            }
        }

        // Konvert–∞—Ü–∏—è –¥–æ–∑–æ–≤–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –≤ ¬µSv/h –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
        function convertToMicroSv(value, unit) {
            if (!Number.isFinite(value) || value < 0) return 0;
            
            if (unit === 'nano') {
                return value / 1000; // nSv -> ¬µSv
            } else if (unit === 'micro') {
                return value; // ¬µSv (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
            } else if (unit === 'milli') {
                return value * 1000; // mSv -> ¬µSv
            } else if (unit === 'base') {
                return value * 1000000; // Sv -> ¬µSv
            }
            return value;
        }

        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ö–∏–º–∏–∫–∞—Ç—ã: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        let normalizedChemicalDatabase;
        try {
            normalizedChemicalDatabase = chemicalDatabase.map(chem => ({
                ...chem,
                type: chem.type || 'toxic',
                lel: chem.lel !== undefined ? chem.lel : null,
                uel: chem.uel !== undefined ? chem.uel : null,
                heatOfCombustion: chem.heatOfCombustion !== undefined ? chem.heatOfCombustion : 0,
                vaporPressure: chem.vaporPressure !== undefined ? chem.vaporPressure : 100
            }));
        } catch (error) {
            console.error('Error normalizing chemical database:', error);
            normalizedChemicalDatabase = chemicalDatabase;
        }

        function App() {
            const [activeTab, setActiveTab] = useState('chemical');
            const [map, setMap] = useState(null);
            const [mapInitialized, setMapInitialized] = useState(false);
            const [panelCollapsed, setPanelCollapsed] = useState(false);
            
            // Keemiamooduli olek (Source Term Model)
            const [selectedChemical, setSelectedChemical] = useState(normalizedChemicalDatabase[0]);
            const [windSpeed, setWindSpeed] = useState(5); // m/s
            const [windDirection, setWindDirection] = useState(270); // kraadid (0=p√µhi, 90=ida, 180=l√µuna, 270=l√§√§s)
            const [stability, setStability] = useState('neutral'); // inversion, neutral, convection
            const [releaseLocation, setReleaseLocation] = useState(null);
            
            // –ù–û–í–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ - ENVIRONMENT & SOURCE
            const [ambientTemperature, setAmbientTemperature] = useState(20); // ¬∞C
            const [containerType, setContainerType] = useState('ibc1000'); // barrel200, ibc1000, tank20000
            const [containerVolume, setContainerVolume] = useState(1000); // –ª–∏—Ç—Ä—ã
            const [poolArea, setPoolArea] = useState(null); // m¬≤ (null = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç)
            
            // –í–ö–õ–Æ–ß–ï–ù–ò–ï/–í–´–ö–õ–Æ–ß–ï–ù–ò–ï –ü–ê–†–ê–ú–ï–¢–†–û–í (—É–ø—Ä–æ—â–µ–Ω–æ - —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ)
            // useTemperature –∏ usePoolArea –£–î–ê–õ–ï–ù–´ - –≤—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è!
            const [useWindSpeed, setUseWindSpeed] = useState(true); // –£—á–∏—Ç—ã–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞
            const [useStability, setUseStability] = useState(true); // –£—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
            
            // –û–ì–ù–ï–ù–ù–´–ô –®–ê–† (–¥–ª—è flammable –≤–µ—â–µ—Å—Ç–≤)
            const [tankOnFire, setTankOnFire] = useState(false); // –†–µ–∂–∏–º "–¶–∏—Å—Ç–µ—Ä–Ω–∞ –≤ –æ–≥–Ω–µ" (BLEVE)
            
            // –ù–û–í–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ - PRESET SCENARIOS (—É–ø—Ä–æ—â–µ–Ω–æ!)
            const [scenario, setScenario] = useState('instant'); // 'instant', 'puddle', 'leak'
            const [puddleLength, setPuddleLength] = useState(10); // –º (–¥–ª—è puddle)
            const [puddleWidth, setPuddleWidth] = useState(5); // –º (–¥–ª—è puddle)
            
            // –¢–∏–ø—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
            const containerTypes = {
                barrel200: { name: '–ë–æ—á–∫–∞ 200L', volume: 200, icon: 'üõ¢Ô∏è' },
                ibc1000: { name: '–ï–≤—Ä–æ–∫—É–± 1000L', volume: 1000, icon: 'üì¶' },
                tank20000: { name: '–¶–∏—Å—Ç–µ—Ä–Ω–∞ 20000L', volume: 20000, icon: 'üöõ' }
            };
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º Source Term (—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å)
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º scenario –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è calculateSourceTerm
            const sourceMode = scenario === 'puddle' ? 'puddle' : 'container';
            const continuousLeak = scenario === 'leak'; // true —Ç–æ–ª—å–∫–æ –¥–ª—è 'leak'
            const effectivePuddleArea = scenario === 'puddle' ? puddleLength * puddleWidth : null;

            const sourceTerm = calculateSourceTerm(
                selectedChemical,
                sourceMode,                      // 'container' –∏–ª–∏ 'puddle'
                containerVolume,                  // –¥–ª—è container/instant/leak
                effectivePuddleArea,              // –¥–ª—è puddle (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ puddleArea)
                ambientTemperature,               // –í–°–ï–ì–î–ê —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É!
                useWindSpeed ? windSpeed : 0,    // —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞
                poolArea,                         // customPoolArea (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–ª—è container)
                continuousLeak                    // true –¥–ª—è 'leak' scenario
            );
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–±—Ä–æ—Å–∞ (kg/min ‚Üí kg/h –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
            const releaseRate = sourceTerm.rate * 60; // kg/min ‚Üí kg/h
            
            // Kiirgusmooduli olek (IAEA standardid)
            const [selectedIsotope, setSelectedIsotope] = useState(isotopeDatabase[0]);
            const [doseRateUnit, setDoseRateUnit] = useState('micro'); // nano, micro, milli, base (Sv)
            const [measuredDoseRate, setMeasuredDoseRate] = useState(1000); // –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            const [measuredDistance, setMeasuredDistance] = useState(1); // m (m√µ√µtmise kaugus)
            const [radiationLocation, setRadiationLocation] = useState(null);
            
            const mapRef = useRef(null);
            const markersRef = useRef([]);
            const zonesRef = useRef([]);

            // Puhasta kaart t√§ielikult
            const clearMap = useCallback((leafletMap) => {
                if (!leafletMap) return;
                try {
                    zonesRef.current.forEach(zone => {
                        try {
                            if (zone && leafletMap.hasLayer(zone)) {
                                leafletMap.removeLayer(zone);
                            }
                        } catch (e) {
                            console.warn('Error removing zone:', e);
                        }
                    });
                    zonesRef.current = [];
                    
                    markersRef.current.forEach(m => {
                        try {
                            if (m && leafletMap.hasLayer(m)) {
                                leafletMap.removeLayer(m);
                            }
                        } catch (e) {
                            console.warn('Error removing marker:', e);
                        }
                    });
                    markersRef.current = [];
                } catch (e) {
                    console.error('Error clearing map:', e);
                }
            }, []);

            useEffect(() => {
                if (!mapInitialized && mapRef.current) {
                    const leafletMap = L.map(mapRef.current).setView([59.4370, 24.7536], 10); // Tallinn
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 19
                    }).addTo(leafletMap);
                    
                    setMap(leafletMap);
                    setMapInitialized(true);
                }
            }, [mapInitialized]);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
            useEffect(() => {
                if (!map) return;
                
                const handleMapClick = (e) => {
                    const loc = [e.latlng.lat, e.latlng.lng];
                    console.log('Map clicked:', loc, 'activeTab:', activeTab);
                    
                    if (activeTab === 'chemical') {
                        setReleaseLocation(loc);
                        setRadiationLocation(null);
                    } else if (activeTab === 'radiation') {
                        setRadiationLocation(loc);
                        setReleaseLocation(null);
                    }
                };
                
                map.on('click', handleMapClick);
                
                return () => {
                    map.off('click', handleMapClick);
                };
            }, [map, activeTab]);

            // Puhasta kaart vahekaardi vahetamisel
            useEffect(() => {
                if (map) {
                    clearMap(map);
                }
            }, [activeTab, map, clearMap]);

            const updateChemicalZones = useCallback((leafletMap, location) => {
                if (!leafletMap || !location || !Array.isArray(location) || location.length !== 2) {
                    return;
                }
                if (!Number.isFinite(location[0]) || !Number.isFinite(location[1])) {
                    return;
                }
                
                try {
                    // Eemalda vanad tsoonid ja markerid
                    zonesRef.current.forEach(zone => {
                        try {
                            if (zone && leafletMap.hasLayer(zone)) {
                                leafletMap.removeLayer(zone);
                            }
                        } catch (e) {
                            console.warn('Error removing zone:', e);
                        }
                    });
                    zonesRef.current = [];
                    
                    markersRef.current.forEach(m => {
                        try {
                            if (m && leafletMap.hasLayer(m)) {
                                leafletMap.removeLayer(m);
                            }
                        } catch (e) {
                            console.warn('Error removing marker:', e);
                        }
                    });
                    markersRef.current = [];
                    
                    // === –†–ï–ñ–ò–ú BLEVE / FIREBALL (–¥–ª—è flammable –≤–µ—â–µ—Å—Ç–≤) ===
                    const chemType = selectedChemical.type || 'toxic';
                    if (tankOnFire && chemType === 'flammable') {
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—Å—É –≤–µ—â–µ—Å—Ç–≤–∞
                        const totalMass = containerVolume * selectedChemical.density; // –∫–≥
                        const fireballZones = calculateFireballZones(totalMass, selectedChemical.heatOfCombustion);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–∞
                        if (!Number.isFinite(fireballZones.fireball) || !Number.isFinite(fireballZones.secondDegree) || !Number.isFinite(fireballZones.thermal)) {
                            console.warn('Invalid fireball calculations');
                            return;
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–≥–æ—Ä—è—â–∞—è —Ü–∏—Å—Ç–µ—Ä–Ω–∞)
                        const fireIcon = L.divIcon({
                            html: '<div style="font-size: 32px;">üî•</div>',
                            className: 'fire-marker',
                            iconSize: [32, 32],
                            iconAnchor: [16, 16]
                        });
                        const releaseMarker = L.marker(location, { icon: fireIcon })
                            .bindPopup(`<b>üî• TANK ON FIRE (BLEVE)</b><br>${selectedChemical.name}<br>–ú–∞—Å—Å–∞: ${totalMass.toFixed(0)} –∫–≥`)
                            .addTo(leafletMap);
                        markersRef.current.push(releaseMarker);
                        
                        // –ó–û–ù–ê 1: FIREBALL (–°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ > 37.5 –∫–í—Ç/–º¬≤)
                        if (fireballZones.fireball > 5) {
                            try {
                                const fireballCircle = L.circle(location, {
                                    radius: fireballZones.fireball,
                                    color: '#7f1d1d', // Dark red
                                    fillColor: '#dc2626',
                                    fillOpacity: 0.7,
                                    weight: 4
                                }).addTo(leafletMap);
                                fireballCircle.bindPopup(`<b>‚ö†Ô∏è –û–ì–ù–ï–ù–ù–´–ô –®–ê–†</b><br>–°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ<br>–†–∞–¥–∏—É—Å: ${fireballZones.fireball.toFixed(0)} m<br>I > 37.5 –∫–í—Ç/–º¬≤`);
                                zonesRef.current.push(fireballCircle);
                            } catch (e) {
                                console.error('Error creating fireball zone:', e);
                            }
                        }
                        
                        // –ó–û–ù–ê 2: –û–ñ–û–ì–ò 2-3 —Å—Ç–µ–ø–µ–Ω–∏ (12.5 –∫–í—Ç/–º¬≤)
                        if (fireballZones.secondDegree > fireballZones.fireball) {
                            try {
                                const burnCircle = L.circle(location, {
                                    radius: fireballZones.secondDegree,
                                    color: '#ea580c', // Orange-600
                                    fillColor: '#f97316',
                                    fillOpacity: 0.4,
                                    weight: 3,
                                    dashArray: '10, 5'
                                }).addTo(leafletMap);
                                burnCircle.bindPopup(`<b>‚ö†Ô∏è –û–ñ–û–ì–ò 2-3 –°–¢–ï–ü–ï–ù–ò</b><br>–¢–µ–ø–ª–æ–≤–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ<br>–†–∞–¥–∏—É—Å: ${fireballZones.secondDegree.toFixed(0)} m<br>I ‚âà 12.5 –∫–í—Ç/–º¬≤`);
                                zonesRef.current.push(burnCircle);
                            } catch (e) {
                                console.error('Error creating burn zone:', e);
                            }
                        }
                        
                        // –ó–û–ù–ê 3: –¢–ï–ü–õ–û–í–û–ï –í–û–ó–î–ï–ô–°–¢–í–ò–ï (4 –∫–í—Ç/–º¬≤)
                        if (fireballZones.thermal > fireballZones.secondDegree) {
                            try {
                                const thermalCircle = L.circle(location, {
                                    radius: fireballZones.thermal,
                                    color: '#f59e0b', // Amber-500
                                    fillColor: '#fbbf24',
                                    fillOpacity: 0.2,
                                    weight: 2,
                                    dashArray: '5, 5'
                                }).addTo(leafletMap);
                                thermalCircle.bindPopup(`<b>‚ö†Ô∏è –ë–û–õ–ï–í–û–ô –ü–û–†–û–ì</b><br>–¢–µ–ø–ª–æ–≤–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ<br>–†–∞–¥–∏—É—Å: ${fireballZones.thermal.toFixed(0)} m<br>I ‚âà 4 –∫–í—Ç/–º¬≤`);
                                zonesRef.current.push(thermalCircle);
                            } catch (e) {
                                console.error('Error creating thermal zone:', e);
                            }
                        }
                        
                        // –ó–∞–≤–µ—Ä—à–∞–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É - –≤ —Ä–µ–∂–∏–º–µ BLEVE –Ω–µ —Ä–∏—Å—É–µ–º –æ–±—ã—á–Ω—ã–µ –∑–æ–Ω—ã
                        return;
                    }
                    
                    // === –û–ë–´–ß–ù–´–ô –†–ï–ñ–ò–ú (Dispersion/Explosion) ===
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º stability —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –≤–∫–ª—é—á–µ–Ω, –∏–Ω–∞—á–µ 'neutral'
                    const effectiveStability = useStability ? stability : 'neutral';
                    const zones = calculateZones(selectedChemical, releaseRate, windSpeed, effectiveStability);
                    
                    // Kontrolli, et tsoonid on kehtivad
                    if (!zones || !Number.isFinite(zones.danger) || !Number.isFinite(zones.security) || !Number.isFinite(zones.clean)) {
                        console.warn('Invalid zone calculations');
                        return;
                    }
                    
                    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–æ–Ω: –ö–†–£–ì–ò (–µ—Å–ª–∏ –≤–µ—Ç–µ—Ä –≤—ã–∫–ª—é—á–µ–Ω) –∏–ª–∏ –ü–õ–Æ–ú–´ (–µ—Å–ª–∏ –≤–µ—Ç–µ—Ä –≤–∫–ª—é—á–µ–Ω)
                    const center = { lat: location[0], lng: location[1] };
                    
                    // –ï–°–õ–ò –í–ï–¢–ï–† –í–´–ö–õ–Æ–ß–ï–ù ‚Üí —Ä–∏—Å—É–µ–º –∫—Ä—É–≥–∏ (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –∑–æ–Ω—ã)
                    if (!useWindSpeed || windSpeed < 0.5) {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–æ–Ω (TOXIC vs FLAMMABLE)
                        const isFlammable = (selectedChemical.type || 'toxic') === 'flammable';
                        
                        // Punane tsoon - –ö–†–£–ì
                        if (zones.danger > 0.01 && Number.isFinite(zones.danger)) {
                            try {
                                const redZone = L.circle(location, {
                                    radius: zones.danger * 1000, // km ‚Üí m
                                    color: '#dc2626',
                                    fillColor: '#dc2626',
                                    fillOpacity: 0.5,
                                    weight: 3
                                }).addTo(leafletMap);
                                
                                const popupText = isFlammable 
                                    ? `<b>üî• FLASH FIRE ZONE</b><br>${selectedChemical.name}<br>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è ‚â• LEL (${selectedChemical.lel} ppm)<br>Raadius: ${(zones.danger * 1000).toFixed(0)} m`
                                    : `<b>Ohuala (AEGL-3)</b><br>${selectedChemical.name}<br>Raadius: ${(zones.danger * 1000).toFixed(0)} m`;
                                
                                redZone.bindPopup(popupText);
                                zonesRef.current.push(redZone);
                            } catch (e) {
                                console.error('Error creating red circle:', e);
                            }
                        }
                        
                        // Kollane tsoon - –ö–†–£–ì
                        if (zones.security > 0.01 && Number.isFinite(zones.security)) {
                            try {
                                const orangeZone = L.circle(location, {
                                    radius: zones.security * 1000, // km ‚Üí m
                                    color: '#f97316',
                                    fillColor: '#f97316',
                                    fillOpacity: 0.3,
                                    weight: 2
                                }).addTo(leafletMap);
                                
                                const popupText = isFlammable 
                                    ? `<b>‚ö†Ô∏è SAFETY BUFFER (10% LEL)</b><br>${selectedChemical.name}<br>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è ‚â• ${(selectedChemical.lel * 0.1).toFixed(0)} ppm<br>Raadius: ${(zones.security * 1000).toFixed(0)} m`
                                    : `<b>Julgestusala (AEGL-2)</b><br>${selectedChemical.name}<br>Raadius: ${(zones.security * 1000).toFixed(0)} m`;
                                
                                orangeZone.bindPopup(popupText);
                                zonesRef.current.push(orangeZone);
                            } catch (e) {
                                console.error('Error creating orange circle:', e);
                            }
                        }
                        
                        // Roheline tsoon (—Ç–æ–ª—å–∫–æ –¥–ª—è toxic) - –ö–†–£–ì
                        if (!isFlammable && zones.clean > 0.01 && Number.isFinite(zones.clean)) {
                            try {
                                const greenZone = L.circle(location, {
                                    radius: zones.clean * 1000, // km ‚Üí m
                                    color: '#22c55e',
                                    fillColor: '#22c55e',
                                    fillOpacity: 0.2,
                                    weight: 2,
                                    dashArray: '5, 5'
                                }).addTo(leafletMap);
                                greenZone.bindPopup(`<b>Puhas ala (AEGL-1)</b><br>${selectedChemical.name}<br>Raadius: ${(zones.clean * 1000).toFixed(0)} m`);
                                zonesRef.current.push(greenZone);
                            } catch (e) {
                                console.error('Error creating green circle:', e);
                            }
                        }
                    } else {
                        // –ï–°–õ–ò –í–ï–¢–ï–† –í–ö–õ–Æ–ß–ï–ù ‚Üí —Ä–∏—Å—É–µ–º –ø–ª—é–º—ã (–≤—ã—Ç—è–Ω—É—Ç—ã–µ –æ–±–ª–∞–∫–∞ –ø–æ –≤–µ—Ç—Ä—É)
                        const isFlammable = (selectedChemical.type || 'toxic') === 'flammable';
                        
                        // Punane tsoon - –ü–õ–Æ–ú
                        if (zones.danger > 0.01 && Number.isFinite(zones.danger)) {
                            const redPlume = createPlumePolygon(center, zones.danger, windDirection, effectiveStability);
                            if (redPlume && redPlume.length >= 3) {
                                try {
                                    const redZone = L.polygon(redPlume, {
                                        color: '#dc2626',
                                        fillColor: '#dc2626',
                                        fillOpacity: 0.5,
                                        weight: 3
                                    }).addTo(leafletMap);
                                    
                                    const popupText = isFlammable 
                                        ? `<b>üî• FLASH FIRE ZONE</b><br>${selectedChemical.name}<br>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è ‚â• LEL (${selectedChemical.lel} ppm)<br>Kaugus: ${(zones.danger * 1000).toFixed(0)} m`
                                        : `<b>Ohuala (AEGL-3)</b><br>${selectedChemical.name}<br>Kaugus: ${(zones.danger * 1000).toFixed(0)} m`;
                                    
                                    redZone.bindPopup(popupText);
                                    zonesRef.current.push(redZone);
                                } catch (e) {
                                    console.error('Error creating red zone:', e);
                                }
                            }
                        }
                        
                        // Kollane tsoon - –ü–õ–Æ–ú
                        if (zones.security > 0.01 && Number.isFinite(zones.security)) {
                            const orangePlume = createPlumePolygon(center, zones.security, windDirection, effectiveStability);
                            if (orangePlume && orangePlume.length >= 3) {
                                try {
                                    const orangeZone = L.polygon(orangePlume, {
                                        color: '#f97316',
                                        fillColor: '#f97316',
                                        fillOpacity: 0.3,
                                        weight: 2
                                    }).addTo(leafletMap);
                                    
                                    const popupText = isFlammable 
                                        ? `<b>‚ö†Ô∏è SAFETY BUFFER (10% LEL)</b><br>${selectedChemical.name}<br>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è ‚â• ${(selectedChemical.lel * 0.1).toFixed(0)} ppm<br>Kaugus: ${(zones.security * 1000).toFixed(0)} m`
                                        : `<b>Julgestusala (AEGL-2)</b><br>${selectedChemical.name}<br>Kaugus: ${(zones.security * 1000).toFixed(0)} m`;
                                    
                                    orangeZone.bindPopup(popupText);
                                    zonesRef.current.push(orangeZone);
                                } catch (e) {
                                    console.error('Error creating orange zone:', e);
                                }
                            }
                        }
                        
                        // Roheline tsoon (—Ç–æ–ª—å–∫–æ –¥–ª—è toxic) - –ü–õ–Æ–ú
                        if (!isFlammable && zones.clean > 0.01 && Number.isFinite(zones.clean)) {
                            const greenPlume = createPlumePolygon(center, zones.clean, windDirection, effectiveStability);
                            if (greenPlume && greenPlume.length >= 3) {
                                try {
                                    const greenZone = L.polygon(greenPlume, {
                                        color: '#22c55e',
                                        fillColor: '#22c55e',
                                        fillOpacity: 0.2,
                                        weight: 2,
                                        dashArray: '5, 5'
                                    }).addTo(leafletMap);
                                    greenZone.bindPopup(`<b>Puhas ala (AEGL-1)</b><br>${selectedChemical.name}<br>Kaugus: ${(zones.clean * 1000).toFixed(0)} m`);
                                    zonesRef.current.push(greenZone);
                                } catch (e) {
                                    console.error('Error creating green zone:', e);
                                }
                            }
                        }
                    }
                    
                    // M√§rgista vabastuspunkt
                    try {
                        const marker = L.marker(location).addTo(leafletMap);
                        marker.bindPopup(`<b>${selectedChemical.name}</b><br>Vabastuspunkt<br>Tuul: ${windDirection}¬∞ (${windSpeed} m/s)`).openPopup();
                        markersRef.current.push(marker);
                    } catch (e) {
                        console.error('Error creating marker:', e);
                    }
                } catch (e) {
                    console.error('Error in updateChemicalZones:', e);
                }
            }, [selectedChemical, releaseRate, windSpeed, windDirection, stability, ambientTemperature, containerVolume, poolArea, useStability, useWindSpeed, tankOnFire]);

            const updateRadiationZones = useCallback((leafletMap, location) => {
                if (!leafletMap || !location || !Array.isArray(location) || location.length !== 2) {
                    return;
                }
                if (!Number.isFinite(location[0]) || !Number.isFinite(location[1])) {
                    return;
                }
                
                try {
                    // Konv–µ—Ä—Ç–∏—Ä—É–µ–º –≤ ¬µSv/h –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
                    const doseRateInMicroSv = convertToMicroSv(measuredDoseRate, doseRateUnit);
                    
                    // Arvuta perimeetrid IAEA standardite j√§rgi (—Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ –∏–∑–ª—É—á–µ–Ω–∏—è!)
                    const perimeters = calculateRadiationPerimetersIAEA(doseRateInMicroSv, measuredDistance, selectedIsotope);
                    
                    // Kontrolli, et perimeetrid on kehtivad
                    if (!perimeters || !Number.isFinite(perimeters.innerCordon) || !Number.isFinite(perimeters.criticalZone)) {
                        console.warn('Invalid perimeter calculations');
                        return;
                    }
                    
                    // 1. SISEMINE OTSELUS (Inner Cordon) - Oran≈æ punktiir
                    if (perimeters.innerCordon > 0 && Number.isFinite(perimeters.innerCordon)) {
                        try {
                            const innerZone = L.circle(location, {
                                radius: perimeters.innerCordon,
                                color: '#f97316', // Oran≈æ
                                fillColor: '#f97316',
                                fillOpacity: 0.2,
                                weight: 3,
                                dashArray: '10, 5' // Punktiir
                            }).addTo(leafletMap);
                            innerZone.bindPopup(`<b>SISEMINE OTSELUS (Inner Cordon)</b><br>IAEA: 100 ¬µSv/h<br>Raadius: ${perimeters.innerCordon.toFixed(0)} m`);
                            zonesRef.current.push(innerZone);
                        } catch (e) {
                            console.error('Error creating inner cordon:', e);
                        }
                    }
                    
                    // 2. KRITILINE TSOON (Critical Zone) - Punane t√§is
                    if (perimeters.criticalZone > 0 && Number.isFinite(perimeters.criticalZone)) {
                        try {
                            const criticalZone = L.circle(location, {
                                radius: perimeters.criticalZone,
                                color: '#dc2626', // Punane
                                fillColor: '#dc2626',
                                fillOpacity: 0.5,
                                weight: 3
                            }).addTo(leafletMap);
                            criticalZone.bindPopup(`<b>KRITILINE TSOON (Critical Zone)</b><br>IAEA: 100 mSv/h<br>Raadius: ${perimeters.criticalZone.toFixed(1)} m`);
                            zonesRef.current.push(criticalZone);
                        } catch (e) {
                            console.error('Error creating critical zone:', e);
                        }
                    }
                    
                    // M√§rgista allikas
                    try {
                        const unitLabel = doseRateUnit === 'nano' ? 'nSv/h' : 
                                         doseRateUnit === 'micro' ? '¬µSv/h' : 
                                         doseRateUnit === 'milli' ? 'mSv/h' : 'Sv/h';
                        const marker = L.marker(location).addTo(leafletMap);
                        marker.bindPopup(`<b>${selectedIsotope.name}</b><br>Allikas<br>M√µ√µdetud: ${measuredDoseRate} ${unitLabel} @ ${measuredDistance} m`).openPopup();
                        markersRef.current.push(marker);
                    } catch (e) {
                        console.error('Error creating marker:', e);
                    }
                } catch (e) {
                    console.error('Error in updateRadiationZones:', e);
                }
            }, [measuredDoseRate, measuredDistance, doseRateUnit, selectedIsotope]);

            useEffect(() => {
                if (map && activeTab === 'chemical' && releaseLocation) {
                    clearMap(map);
                    updateChemicalZones(map, releaseLocation);
                }
            }, [map, activeTab, releaseLocation, updateChemicalZones, clearMap, ambientTemperature, containerVolume, releaseRate, poolArea, useWindSpeed, useStability]);

            useEffect(() => {
                if (map && activeTab === 'radiation' && radiationLocation) {
                    clearMap(map);
                    updateRadiationZones(map, radiationLocation);
                }
            }, [map, activeTab, radiationLocation, measuredDoseRate, measuredDistance, updateRadiationZones, clearMap]);

            // Arvuta radiaatsiooni tulemused (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ ¬µSv/h)
            const doseRateInMicroSvForDisplay = convertToMicroSv(measuredDoseRate, doseRateUnit);
            const radiationResults = calculateRadiationPerimetersIAEA(doseRateInMicroSvForDisplay, measuredDistance, selectedIsotope);

            const [bottomNavActive, setBottomNavActive] = useState('map');
            
            return (
                <div style={{ width: '100vw', height: '100vh', position: 'relative', overflow: 'hidden' }}>
                    {/* Kaart taustal */}
                    <div ref={mapRef} id="map"></div>
                    
                    {/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */}
                    <div className={`sidebar ${panelCollapsed ? 'collapsed' : ''}`}>
                        {/* –•–µ–¥–µ—Ä */}
                        <div className="app-header">
                            <div className="app-logo">‚ò¢Ô∏è</div>
                            <div>
                                <div className="app-title">CBRN <span className="app-title-sub">PRO</span></div>
                            </div>
                        </div>
                        
                        {/* –í–∫–ª–∞–¥–∫–∏ —Ç–∏–ø–æ–≤ —É–≥—Ä–æ–∑ */}
                        <div className="threat-tabs">
                            <div 
                                className={`threat-tab ${activeTab === 'chemical' ? 'active' : ''}`}
                                onClick={() => {
                                    setActiveTab('chemical');
                                    setRadiationLocation(null);
                                }}
                            >
                                <div className="threat-icon">‚öóÔ∏è</div>
                                <div>Keemia</div>
                            </div>
                            <div 
                                className={`threat-tab ${activeTab === 'radiation' ? 'active' : ''}`}
                                onClick={() => {
                                    setActiveTab('radiation');
                                    setReleaseLocation(null);
                                }}
                            >
                                <div className="threat-icon">‚ò¢Ô∏è</div>
                                <div>Kiirgus</div>
                            </div>
                        </div>
                        
                        {/* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏ */}
                        <div className="panel-content">
                            {/* Keemiamoodul */}
                            {activeTab === 'chemical' && (
                                <div>
                                    <div className="section">
                                        <div className="section-title">‚öóÔ∏è Keemiline aine</div>
                                        <div className="input-group">
                                            <label className="input-label">Vali aine</label>
                                            <select
                                                value={normalizedChemicalDatabase.findIndex(c => c.name === selectedChemical.name)}
                                                onChange={(e) => setSelectedChemical(normalizedChemicalDatabase[parseInt(e.target.value)])}
                                                className="tactical-select"
                                            >
                                                {normalizedChemicalDatabase.map((chem, idx) => (
                                                    <option key={idx} value={idx}>{chem.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div style={{fontSize: '12px', color: '#8b92b0', marginTop: '8px', lineHeight: '1.5'}}>
                                            <div><b>CAS:</b> {selectedChemical.cas}</div>
                                            <div><b>V√§limus:</b> {selectedChemical.appearance}</div>
                                            <div><b>IDLH:</b> {selectedChemical.idlh} ppm</div>
                                        </div>
                                    </div>

                                    {/* ENVIRONMENT (–°—Ä–µ–¥–∞) */}
                                    <div className="section">
                                        <div className="section-title">üå°Ô∏è ENVIRONMENT (Keskkond)</div>
                                        
                                        {/* –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –í–°–ï–ì–î–ê —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è - toggle —É–±—Ä–∞–Ω! */}
                                        <div className="input-group">
                                            <label className="input-label">Temperatuur (¬∞C)</label>
                                            <div className="slider-container">
                                                <input
                                                    type="range"
                                                    min="-30"
                                                    max="50"
                                                    step="1"
                                                    value={ambientTemperature}
                                                    onChange={(e) => setAmbientTemperature(parseFloat(e.target.value))}
                                                    className="tactical-slider"
                                                />
                                                <input
                                                    type="number"
                                                    min="-30"
                                                    max="50"
                                                    step="1"
                                                    value={ambientTemperature}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        if (!isNaN(val) && val >= -30 && val <= 50) {
                                                            setAmbientTemperature(val);
                                                        }
                                                    }}
                                                    className="slider-value"
                                                />
                                            </div>
                                        </div>
                                        
                                        {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–∏–ø–µ –≤—ã–±—Ä–æ—Å–∞ */}
                                        {sourceTerm.warning && (
                                            <div style={{
                                                marginTop: '12px',
                                                padding: '12px',
                                                background: sourceTerm.scenario === 'flash' 
                                                    ? 'rgba(220, 38, 38, 0.2)' 
                                                    : 'rgba(249, 115, 22, 0.2)',
                                                border: `1px solid ${sourceTerm.scenario === 'flash' ? '#DC2626' : '#F97316'}`,
                                                borderRadius: '10px',
                                                fontSize: '11px',
                                                lineHeight: '1.4',
                                                color: '#ffffff'
                                            }} dangerouslySetInnerHTML={{ __html: sourceTerm.warning }}>
                                            </div>
                                        )}
                                    </div>

                                    {/* SOURCE (–ò—Å—Ç–æ—á–Ω–∏–∫) */}
                                    <div className="section">
                                        <div className="section-title">üì¶ SOURCE (Allikas)</div>
                                        
                                        {/* PRESET SCENARIOS - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä! */}
                                        <div className="input-group">
                                            <label className="input-label">Stsenaarium / Scenario</label>
                                            <div className="button-group" style={{display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '6px'}}>
                                                <button
                                                    onClick={() => setScenario('instant')}
                                                    className={`option-button ${scenario === 'instant' ? 'active' : ''}`}
                                                    style={{fontSize: '11px', padding: '8px 4px'}}
                                                >
                                                    üì¶
                                                    <br/>
                                                    <span style={{fontSize: '10px', fontWeight: '600'}}>INSTANT</span>
                                                    <br/>
                                                    <span style={{fontSize: '8px', opacity: 0.7}}>Kiire</span>
                                                </button>
                                                <button
                                                    onClick={() => setScenario('puddle')}
                                                    className={`option-button ${scenario === 'puddle' ? 'active' : ''}`}
                                                    style={{fontSize: '11px', padding: '8px 4px'}}
                                                >
                                                    üíß
                                                    <br/>
                                                    <span style={{fontSize: '10px', fontWeight: '600'}}>PUDDLE</span>
                                                    <br/>
                                                    <span style={{fontSize: '8px', opacity: 0.7}}>Lekke</span>
                                                </button>
                                                <button
                                                    onClick={() => setScenario('leak')}
                                                    className={`option-button ${scenario === 'leak' ? 'active' : ''}`}
                                                    style={{fontSize: '11px', padding: '8px 4px'}}
                                                >
                                                    üö∞
                                                    <br/>
                                                    <span style={{fontSize: '10px', fontWeight: '600'}}>LEAK</span>
                                                    <br/>
                                                    <span style={{fontSize: '8px', opacity: 0.7}}>Pidev</span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è */}
                                        <div style={{
                                            marginTop: '8px',
                                            padding: '8px',
                                            background: 'rgba(59, 130, 246, 0.1)',
                                            border: '1px solid rgba(59, 130, 246, 0.3)',
                                            borderRadius: '6px',
                                            fontSize: '10px',
                                            lineHeight: '1.4',
                                            color: '#60a5fa'
                                        }}>
                                            {scenario === 'instant' && 'üì¶ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ —Ü–∏—Å—Ç–µ—Ä–Ω—ã - –≤—Å—ë –≤–µ—â–µ—Å—Ç–≤–æ –≤—ã–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É'}
                                            {scenario === 'puddle' && 'üíß –õ—É–∂–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã —Ç–æ–≥–æ, —á—Ç–æ –≤–∏–¥–∏—Ç–µ'}
                                            {scenario === 'leak' && 'üö∞ –°—Ç—Ä—É–π–Ω–∞—è —É—Ç–µ—á–∫–∞ - –≤–µ—â–µ—Å—Ç–≤–æ –≤—ã—Ç–µ–∫–∞–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (10%/–º–∏–Ω)'}
                                        </div>
                                        
                                        {/* === –°–¶–ï–ù–ê–†–ò–ô: INSTANT –∏–ª–∏ LEAK (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) === */}
                                        {(scenario === 'instant' || scenario === 'leak') && (
                                            <>
                                                <div className="input-group">
                                                    <label className="input-label">Konteiner</label>
                                                    <select
                                                        value={containerType}
                                                        onChange={(e) => {
                                                            setContainerType(e.target.value);
                                                            setContainerVolume(containerTypes[e.target.value].volume);
                                                        }}
                                                        className="tactical-select"
                                                    >
                                                        <option value="barrel200">{containerTypes.barrel200.icon} {containerTypes.barrel200.name}</option>
                                                        <option value="ibc1000">{containerTypes.ibc1000.icon} {containerTypes.ibc1000.name}</option>
                                                        <option value="tank20000">{containerTypes.tank20000.icon} {containerTypes.tank20000.name}</option>
                                                    </select>
                                                </div>
                                                
                                                <div className="input-group">
                                                    <label className="input-label">Maht (litrid)</label>
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        max="100000"
                                                        step="1"
                                                        value={containerVolume}
                                                        onChange={(e) => {
                                                            const val = parseFloat(e.target.value);
                                                            if (!isNaN(val) && val > 0) {
                                                                setContainerVolume(val);
                                                            }
                                                        }}
                                                        className="tactical-input"
                                                        style={{fontFamily: 'monospace', fontSize: '16px', fontWeight: '700'}}
                                                    />
                                                </div>
                                                
                                                {/* Continuous Leak checkbox –£–î–ê–õ–ï–ù - —Ç–µ–ø–µ—Ä—å —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π! */}
                                                
                                                {/* –ü–ª–æ—â–∞–¥—å —Ä–∞–∑–ª–∏–≤–∞ - –í–°–ï–ì–î–ê —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (toggle —É–±—Ä–∞–Ω!) */}
                                                <div className="input-group" style={{marginTop: '12px'}}>
                                                    <label className="input-label">
                                                        Lekke pindala (m¬≤) 
                                                        <span style={{fontSize: '10px', color: '#6b7280', marginLeft: '6px'}}>
                                                            {poolArea === null ? '(automaatne)' : '(k√§sitsi)'}
                                                        </span>
                                                    </label>
                                                    <div style={{display: 'flex', gap: '8px', alignItems: 'center'}}>
                                                        <input
                                                            type="number"
                                                            min="0.1"
                                                            max="10000"
                                                            step="0.1"
                                                            value={poolArea !== null ? poolArea : sourceTerm.poolArea.toFixed(1)}
                                                            onChange={(e) => {
                                                                const val = parseFloat(e.target.value);
                                                                if (!isNaN(val) && val > 0) {
                                                                    setPoolArea(val);
                                                                }
                                                            }}
                                                            className="tactical-input"
                                                            style={{fontFamily: 'monospace', fontSize: '16px', fontWeight: '700', flex: 1}}
                                                            placeholder="Auto"
                                                        />
                                                        <button
                                                            onClick={() => setPoolArea(null)}
                                                            style={{
                                                                padding: '10px 16px',
                                                                background: poolArea === null ? 'rgba(99, 102, 241, 0.2)' : 'rgba(51, 65, 85, 0.6)',
                                                                border: poolArea === null ? '1px solid #6366f1' : '1px solid rgba(255, 255, 255, 0.1)',
                                                                borderRadius: '8px',
                                                                color: '#ffffff',
                                                                fontSize: '12px',
                                                                fontWeight: '700',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s',
                                                                whiteSpace: 'nowrap'
                                                            }}
                                                        >
                                                            AUTO
                                                        </button>
                                                    </div>
                                                    <div style={{fontSize: '11px', color: '#8b92b0', marginTop: '6px', lineHeight: '1.4'}}>
                                                        üí° –ü–ª–æ—â–∞–¥—å –∏—Å–ø–∞—Ä–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–±—Ä–æ—Å–∞.
                                                        <br/>
                                                        AUTO: –ø–ª–æ—â–∞–¥—å = –æ–±—ä–µ–º / –≥–ª—É–±–∏–Ω–∞ (1 —Å–º)
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                        
                                        {/* === –°–¶–ï–ù–ê–†–ò–ô: PUDDLE (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª—É–∂–∞) === */}
                                        {scenario === 'puddle' && (
                                            <>
                                                <div style={{
                                                    marginBottom: '12px',
                                                    padding: '10px',
                                                    background: 'rgba(59, 130, 246, 0.1)',
                                                    border: '1px solid rgba(59, 130, 246, 0.3)',
                                                    borderRadius: '8px',
                                                    fontSize: '11px',
                                                    lineHeight: '1.4',
                                                    color: '#60a5fa'
                                                }}>
                                                    ‚ÑπÔ∏è <b>PUDDLE MODE:</b>
                                                    <br/>
                                                    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–ª–∏–≤–æ–≤.
                                                    <br/>
                                                    –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –ª—É–∂–∏, –∫–æ—Ç–æ—Ä—É—é –≤–∏–¥–∏—Ç–µ.
                                                </div>
                                                
                                                <div className="input-group">
                                                    <label className="input-label">Pool Length / Lekke pikkus (m)</label>
                                                    <input
                                                        type="number"
                                                        min="0.1"
                                                        max="1000"
                                                        step="0.1"
                                                        value={puddleLength}
                                                        onChange={(e) => {
                                                            const val = parseFloat(e.target.value);
                                                            if (!isNaN(val) && val > 0) {
                                                                setPuddleLength(val);
                                                            }
                                                        }}
                                                        className="tactical-input"
                                                        style={{fontFamily: 'monospace', fontSize: '16px', fontWeight: '700'}}
                                                    />
                                                </div>
                                                
                                                <div className="input-group">
                                                    <label className="input-label">Pool Width / Lekke laius (m)</label>
                                                    <input
                                                        type="number"
                                                        min="0.1"
                                                        max="1000"
                                                        step="0.1"
                                                        value={puddleWidth}
                                                        onChange={(e) => {
                                                            const val = parseFloat(e.target.value);
                                                            if (!isNaN(val) && val > 0) {
                                                                setPuddleWidth(val);
                                                            }
                                                        }}
                                                        className="tactical-input"
                                                        style={{fontFamily: 'monospace', fontSize: '16px', fontWeight: '700'}}
                                                    />
                                                </div>
                                                
                                                <div style={{
                                                    marginTop: '8px',
                                                    padding: '10px',
                                                    background: 'rgba(99, 102, 241, 0.1)',
                                                    border: '1px solid rgba(99, 102, 241, 0.3)',
                                                    borderRadius: '8px',
                                                    fontSize: '12px',
                                                    lineHeight: '1.4'
                                                }}>
                                                    <div style={{fontWeight: '700', color: '#9ca3af', marginBottom: '4px'}}>
                                                        CALCULATED AREA:
                                                    </div>
                                                    <div style={{fontSize: '20px', fontWeight: '800', color: '#ffffff', fontFamily: 'monospace'}}>
                                                        {(puddleLength * puddleWidth).toFixed(1)} m¬≤
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                        
                                        {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–±—Ä–æ—Å–∞ */}
                                        <div style={{
                                            marginTop: '12px',
                                            padding: '12px',
                                            background: 'rgba(99, 102, 241, 0.1)',
                                            border: '1px solid rgba(99, 102, 241, 0.3)',
                                            borderRadius: '10px',
                                            fontSize: '12px',
                                            lineHeight: '1.5'
                                        }}>
                                            <div style={{fontWeight: '700', color: '#9ca3af', marginBottom: '4px'}}>
                                                CALCULATED SOURCE STRENGTH:
                                            </div>
                                            <div style={{fontSize: '20px', fontWeight: '800', color: '#ffffff', fontFamily: 'monospace'}}>
                                                {sourceTerm.rate.toFixed(2)} kg/min
                                            </div>
                                            <div style={{fontSize: '11px', color: '#8b92b0', marginTop: '4px'}}>
                                                ({releaseRate.toFixed(0)} kg/h)
                                            </div>
                                            {sourceTerm.totalMass > 0 && (
                                                <div style={{fontSize: '11px', color: '#8b92b0', marginTop: '4px'}}>
                                                    Total mass: {sourceTerm.totalMass.toFixed(0)} kg
                                                </div>
                                            )}
                                            {sourceTerm.duration > 0 && (
                                                <div style={{fontSize: '11px', color: '#fbbf24', marginTop: '6px', fontWeight: '700'}}>
                                                    ‚è±Ô∏è Estimated Duration: {sourceTerm.duration} min
                                                    {sourceTerm.duration > 60 && ` (${(sourceTerm.duration/60).toFixed(1)} h)`}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="section">
                                        <div className="section-title">üå¨Ô∏è Tuule tingimused</div>
                                        
                                        {/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–µ—Ç—Ä–∞ */}
                                        <div className={`toggle-container ${!useWindSpeed ? 'disabled' : ''}`}>
                                            <div className="toggle-label">
                                                <span>üí®</span>
                                                <span>Tuule m√µju</span>
                                            </div>
                                            <div 
                                                className={`toggle-switch ${useWindSpeed ? 'active' : ''}`}
                                                onClick={() => setUseWindSpeed(!useWindSpeed)}
                                            >
                                                <div className="toggle-thumb"></div>
                                            </div>
                                        </div>
                                        
                                        <div className="input-group" style={{opacity: useWindSpeed ? 1 : 0.4, pointerEvents: useWindSpeed ? 'auto' : 'none'}}>
                                            <label className="input-label">Tuule kiirus (m/s)</label>
                                            <div className="slider-container">
                                                <input
                                                    type="range"
                                                    min="0.5"
                                                    max="20"
                                                    step="0.5"
                                                    value={windSpeed}
                                                    onChange={(e) => setWindSpeed(parseFloat(e.target.value))}
                                                    className="tactical-slider"
                                                />
                                                <input
                                                    type="number"
                                                    min="0.5"
                                                    max="20"
                                                    step="0.1"
                                                    value={windSpeed}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        if (!isNaN(val) && val >= 0.5 && val <= 20) {
                                                            setWindSpeed(val);
                                                        }
                                                    }}
                                                    className="slider-value"
                                                />
                                            </div>
                                        </div>

                                        <div className="input-group" style={{opacity: useWindSpeed ? 1 : 0.4, pointerEvents: useWindSpeed ? 'auto' : 'none'}}>
                                            <label className="input-label">Tuule suund (¬∞)</label>
                                            <div className="slider-container">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="360"
                                                    step="1"
                                                    value={windDirection}
                                                    onChange={(e) => setWindDirection(parseFloat(e.target.value))}
                                                    className="tactical-slider"
                                                />
                                                <input
                                                    type="number"
                                                    min="0"
                                                    max="360"
                                                    step="1"
                                                    value={windDirection}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        if (!isNaN(val) && val >= 0 && val <= 360) {
                                                            setWindDirection(val);
                                                        }
                                                    }}
                                                    className="slider-value"
                                                />
                                            </div>
                                        </div>

                                        {/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ */}
                                        <div className={`toggle-container ${!useStability ? 'disabled' : ''}`}>
                                            <div className="toggle-label">
                                                <span>üå§Ô∏è</span>
                                                <span>Atmosf√§√§ri stabiilsuse m√µju</span>
                                            </div>
                                            <div 
                                                className={`toggle-switch ${useStability ? 'active' : ''}`}
                                                onClick={() => setUseStability(!useStability)}
                                            >
                                                <div className="toggle-thumb"></div>
                                            </div>
                                        </div>
                                        
                                        <div className="input-group" style={{opacity: useStability ? 1 : 0.4, pointerEvents: useStability ? 'auto' : 'none'}}>
                                            <label className="input-label">Atmosf√§√§ri stabiilsus</label>
                                            <div className="button-group">
                                                <button
                                                    onClick={() => setStability('convection')}
                                                    className={`option-button ${stability === 'convection' ? 'active' : ''}`}
                                                >
                                                    ‚òÄÔ∏è P√§ev
                                                </button>
                                                <button
                                                    onClick={() => setStability('neutral')}
                                                    className={`option-button ${stability === 'neutral' ? 'active' : ''}`}
                                                >
                                                    ‚òÅÔ∏è Pilves
                                                </button>
                                                <button
                                                    onClick={() => setStability('inversion')}
                                                    className={`option-button ${stability === 'inversion' ? 'active' : ''}`}
                                                >
                                                    üåô √ñ√∂
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {/* BLEVE / TANK ON FIRE —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –¥–ª—è flammable) */}
                                        {(selectedChemical.type === 'flammable') && (
                                            <>
                                                <div style={{
                                                    margin: '16px 0',
                                                    height: '1px',
                                                    background: 'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent)'
                                                }}></div>
                                                
                                                <div className="toggle-container" style={{
                                                    background: tankOnFire ? 'rgba(234, 88, 12, 0.15)' : 'rgba(51, 65, 85, 0.3)',
                                                    border: tankOnFire ? '1px solid rgba(234, 88, 12, 0.4)' : '1px solid rgba(255, 255, 255, 0.05)',
                                                    padding: '12px',
                                                    borderRadius: '12px'
                                                }}>
                                                    <div className="toggle-label">
                                                        <span style={{fontSize: '20px'}}>üî•</span>
                                                        <div>
                                                            <div style={{fontSize: '14px', fontWeight: '700', color: '#ffffff'}}>
                                                                TANK ON FIRE (BLEVE)
                                                            </div>
                                                            <div style={{fontSize: '10px', color: '#9ca3af', marginTop: '2px'}}>
                                                                –¢–µ–ø–ª–æ–≤–æ–µ –∏–∑–ª—É—á–µ–Ω–∏–µ –æ—Ç –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div 
                                                        className={`toggle-switch ${tankOnFire ? 'active' : ''}`}
                                                        onClick={() => setTankOnFire(!tankOnFire)}
                                                        style={{
                                                            background: tankOnFire ? 'linear-gradient(135deg, #ea580c, #dc2626)' : 'rgba(51, 65, 85, 0.6)'
                                                        }}
                                                    >
                                                        <div className="toggle-thumb"></div>
                                                    </div>
                                                </div>
                                                
                                                {tankOnFire && (
                                                    <div style={{
                                                        marginTop: '12px',
                                                        padding: '10px',
                                                        background: 'rgba(234, 88, 12, 0.1)',
                                                        border: '1px solid rgba(234, 88, 12, 0.3)',
                                                        borderRadius: '8px',
                                                        fontSize: '11px',
                                                        lineHeight: '1.5',
                                                        color: '#fbbf24'
                                                    }}>
                                                        ‚ö†Ô∏è <b>BLEVE-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!</b>
                                                        <br/>
                                                        –†–∞—Å—á–µ—Ç —Ç–µ–ø–ª–æ–≤—ã—Ö –∑–æ–Ω –æ—Ç –≤–∑—Ä—ã–≤–∞ —Ä–∞—Å—à–∏—Ä—è—é—â–∏—Ö—Å—è –ø–∞—Ä–æ–≤ –∫–∏–ø—è—â–µ–π –∂–∏–¥–∫–æ—Å—Ç–∏.
                                                        <br/>
                                                        –í–µ—Ç–µ—Ä –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ–æ—Ä–º—É –∑–æ–Ω (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –∫—Ä—É–≥–∏).
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>

                                    <div style={{padding: '12px', textAlign: 'center', fontSize: '13px', color: '#8b92b0'}}>
                                        üìç Kliki kaardil, et m√§√§rata vabastuspunkt
                                    </div>
                                </div>
                            )}

                            {/* Kiirgusmoodul */}
                            {activeTab === 'radiation' && (
                                <div>
                                    <div className="section">
                                        <div className="section-title">‚ò¢Ô∏è Isotoop</div>
                                        <div className="input-group">
                                            <label className="input-label">Vali isotoop</label>
                                            <select
                                                value={isotopeDatabase.findIndex(i => i.name === selectedIsotope.name)}
                                                onChange={(e) => setSelectedIsotope(isotopeDatabase[parseInt(e.target.value)])}
                                                className="tactical-select"
                                            >
                                                {isotopeDatabase.map((iso, idx) => (
                                                    <option key={idx} value={idx}>{iso.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div style={{fontSize: '12px', color: '#8b92b0', marginTop: '8px', lineHeight: '1.5'}}>
                                            <div><b>Poolestusaeg:</b> {selectedIsotope.halfLife}</div>
                                            <div><b>Ohtlikkus:</b> {selectedIsotope.dangerLevel}</div>
                                        </div>
                                    </div>

                                    <div className="section">
                                        <div className="section-title">üìä M√µ√µtmise andmed</div>
                                        
                                        <div className="input-group">
                                            <label className="input-label">√úhik</label>
                                            <select
                                                value={doseRateUnit}
                                                onChange={(e) => {
                                                    const newUnit = e.target.value;
                                                    const currentInMicro = convertToMicroSv(measuredDoseRate, doseRateUnit);
                                                    let newValue;
                                                    if (newUnit === 'nano') {
                                                        newValue = currentInMicro * 1000;
                                                    } else if (newUnit === 'micro') {
                                                        newValue = currentInMicro;
                                                    } else if (newUnit === 'milli') {
                                                        newValue = currentInMicro / 1000;
                                                    } else if (newUnit === 'base') {
                                                        newValue = currentInMicro / 1000000;
                                                    }
                                                    setDoseRateUnit(newUnit);
                                                    setMeasuredDoseRate(newValue);
                                                }}
                                                className="tactical-select"
                                            >
                                                <option value="nano">nSv/h (nano)</option>
                                                <option value="micro">¬µSv/h (mikro)</option>
                                                <option value="milli">mSv/h (milli)</option>
                                                <option value="base">Sv/h (sivert)</option>
                                            </select>
                                        </div>

                                        
                                        <div className="input-group">
                                            <label className="input-label">
                                                M√µ√µdetud doosikiirus ({doseRateUnit === 'nano' ? 'nSv/h' : doseRateUnit === 'micro' ? '¬µSv/h' : doseRateUnit === 'milli' ? 'mSv/h' : 'Sv/h'})
                                            </label>
                                            <div className="slider-container">
                                                <input
                                                    type="range"
                                                    min={doseRateUnit === 'nano' ? 1 : doseRateUnit === 'micro' ? 0.001 : doseRateUnit === 'milli' ? 0.000001 : 0.000000001}
                                                    max={doseRateUnit === 'nano' ? 100000000 : doseRateUnit === 'micro' ? 100000 : doseRateUnit === 'milli' ? 100 : 0.1}
                                                    step={doseRateUnit === 'nano' ? 1000 : doseRateUnit === 'micro' ? 1 : doseRateUnit === 'milli' ? 0.001 : 0.000001}
                                                    value={measuredDoseRate}
                                                    onChange={(e) => setMeasuredDoseRate(parseFloat(e.target.value))}
                                                    className="tactical-slider"
                                                />
                                                <input
                                                    type="number"
                                                    min={doseRateUnit === 'nano' ? 1 : doseRateUnit === 'micro' ? 0.001 : doseRateUnit === 'milli' ? 0.000001 : 0.000000001}
                                                    max={doseRateUnit === 'nano' ? 100000000 : doseRateUnit === 'micro' ? 100000 : doseRateUnit === 'milli' ? 100 : 0.1}
                                                    step={doseRateUnit === 'nano' ? 1000 : doseRateUnit === 'micro' ? 1 : doseRateUnit === 'milli' ? 0.001 : 0.000001}
                                                    value={measuredDoseRate}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        const min = doseRateUnit === 'nano' ? 1 : doseRateUnit === 'micro' ? 0.001 : doseRateUnit === 'milli' ? 0.000001 : 0.000000001;
                                                        const max = doseRateUnit === 'nano' ? 100000000 : doseRateUnit === 'micro' ? 100000 : doseRateUnit === 'milli' ? 100 : 0.1;
                                                        if (!isNaN(val) && val >= min && val <= max) {
                                                            setMeasuredDoseRate(val);
                                                        }
                                                    }}
                                                    className="slider-value"
                                                />
                                            </div>
                                        </div>

                                        <div className="input-group">
                                            <label className="input-label">M√µ√µtmise kaugus (m)</label>
                                            <div className="slider-container">
                                                <input
                                                    type="range"
                                                    min="0.1"
                                                    max="100"
                                                    step="0.1"
                                                    value={measuredDistance}
                                                    onChange={(e) => setMeasuredDistance(parseFloat(e.target.value))}
                                                    className="tactical-slider"
                                                />
                                                <input
                                                    type="number"
                                                    min="0.1"
                                                    max="100"
                                                    step="0.1"
                                                    value={measuredDistance}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        if (!isNaN(val) && val >= 0.1 && val <= 100) {
                                                            setMeasuredDistance(val);
                                                        }
                                                    }}
                                                    className="slider-value"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {radiationResults && (radiationResults.innerCordon > 0 || radiationResults.criticalZone > 0) && (
                                        <div className="results-panel">
                                            <div style={{fontSize: '14px', fontWeight: '700', color: '#ffffff', marginBottom: '12px'}}>
                                                IAEA Perimeetrid
                                            </div>
                                            
                                            <div className="result-item">
                                                <div className="result-icon orange">üü†</div>
                                                <div className="result-info">
                                                    <div className="result-label">Inner Cordon (100 ¬µSv/h)</div>
                                                    <div className="result-value">{radiationResults.innerCordon.toFixed(0)} m</div>
                                                </div>
                                            </div>

                                            <div className="result-item" style={{marginBottom: '0'}}>
                                                <div className="result-icon red">üî¥</div>
                                                <div className="result-info">
                                                    <div className="result-label">Critical Zone (100 mSv/h)</div>
                                                    <div className="result-value">{radiationResults.criticalZone.toFixed(1)} m</div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div style={{padding: '12px', textAlign: 'center', fontSize: '13px', color: '#8b92b0'}}>
                                        üìç Kliki kaardil, et m√§√§rata allika asukoht
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è */}
                    <div className={`toggle-sidebar ${panelCollapsed ? 'collapsed' : ''}`} onClick={() => setPanelCollapsed(!panelCollapsed)}>
                        {panelCollapsed ? '‚ò∞' : '√ó'}
                    </div>
                    
                    {/* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */}
                    <div className="bottom-nav">
                        <div className={`nav-item ${bottomNavActive === 'map' ? 'active' : ''}`} onClick={() => setBottomNavActive('map')}>
                            <div className="nav-icon">üó∫Ô∏è</div>
                            <div className="nav-label">Kaart</div>
                        </div>
                        <div className={`nav-item ${bottomNavActive === 'data' ? 'active' : ''}`} onClick={() => setBottomNavActive('data')}>
                            <div className="nav-icon">üìä</div>
                            <div className="nav-label">Andmed</div>
                        </div>
                        <div className={`nav-item ${bottomNavActive === 'tools' ? 'active' : ''}`} onClick={() => setBottomNavActive('tools')}>
                            <div className="nav-icon">üõ†Ô∏è</div>
                            <div className="nav-label">T√∂√∂riistad</div>
                        </div>
                        <div className={`nav-item ${bottomNavActive === 'report' ? 'active' : ''}`} onClick={() => setBottomNavActive('report')}>
                            <div className="nav-icon">üìã</div>
                            <div className="nav-label">Aruanne</div>
                        </div>
                    </div>
                </div>
            );
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        try {
            ReactDOM.render(<App />, document.getElementById('root'));
        } catch (error) {
            console.error('Fatal error:', error);
            document.body.innerHTML = '<div style="color: white; padding: 20px; font-family: monospace;"><h1>ERROR</h1><pre>' + error.toString() + '</pre><p>Check console for details (F12)</p></div>';
        }
    </script>
</body>
</html>
