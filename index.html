<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CBRN P√§√§ste">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/144/radioactive.png">
    
    <title>CBRN Ohutusjuhend</title>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --header: rgba(28, 28, 30, 0.95);
            --accent: #0a84ff;
            --danger: #ff453a;
            --warn: #ff9f0a;
            --safe: #32d74b;
            --rad: #ffd60a;
            --text: #ffffff;
            --subtext: #8e8e93;
            --border: #38383a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            padding-bottom: 100px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* HEADER */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: var(--header);
            backdrop-filter: blur(20px);
            padding: 50px 16px 15px;
            border-bottom: 1px solid var(--border);
        }
        .app-title { font-size: 24px; font-weight: 800; }
        .app-sub { font-size: 12px; color: var(--subtext); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }

        /* TABS */
        .view-section { display: none; padding: 16px; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* SUB-NAV (Radiation) */
        .sub-nav { display: flex; gap: 8px; margin-bottom: 20px; background: #2c2c2e; padding: 4px; border-radius: 10px; }
        .sub-btn { 
            flex: 1; padding: 8px; border-radius: 7px; 
            text-align: center; font-size: 13px; font-weight: 600; color: #888;
        }
        .sub-btn.active { background: #636366; color: white; }

        /* CARDS */
        .card { background: var(--card); border-radius: 14px; padding: 16px; margin-bottom: 12px; }
        
        /* SAFETY RULES STYLING */
        .rule-box { 
            border-left: 4px solid var(--subtext); 
            padding-left: 12px; margin-bottom: 16px; 
        }
        .rule-title { font-weight: 700; font-size: 15px; margin-bottom: 4px; display: block; }
        .rule-desc { font-size: 14px; color: #ccc; line-height: 1.4; }
        
        .border-red { border-left-color: var(--danger); }
        .border-yellow { border-left-color: var(--rad); }
        .border-green { border-left-color: var(--safe); }

        /* DATA TABLE */
        .data-table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 8px; }
        .data-table td { padding: 8px 0; border-bottom: 1px solid #333; }
        .data-table tr:last-child td { border-bottom: none; }
        .val { font-weight: 700; float: right; font-family: monospace; font-size: 15px; }

        /* TOOLS & CALCULATORS */
        input, select {
            width: 100%; padding: 14px; background: #2c2c2e; border: 1px solid #444;
            border-radius: 10px; color: white; font-size: 16px; margin-bottom: 10px; box-sizing: border-box;
        }
        .btn-action {
            width: 100%; padding: 16px; background: var(--rad); color: black;
            font-weight: 800; border: none; border-radius: 12px; font-size: 16px; margin-top: 10px;
        }

        /* NAVIGATION BAR */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(28,28,30,0.95);
            backdrop-filter: blur(20px); border-top: 1px solid var(--border);
            display: flex; padding-bottom: env(safe-area-inset-bottom); padding-top: 8px;
        }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 10px; padding: 4px; }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 2px; }

        /* CHEM LIST STYLES */
        .chem-item { padding: 14px; border-bottom: 1px solid #333; cursor: pointer; }
        .chem-name { font-weight: 700; font-size: 17px; }
        .chem-sub { font-size: 12px; color: #888; margin-top: 4px; }
        .chem-badge { float: right; background: #333; padding: 2px 6px; border-radius: 4px; font-size: 12px; color: var(--accent); }

    </style>
</head>
<body>

<header>
    <div class="app-title">CBRN <span style="color:var(--accent)">ULTIMATE</span></div>
    <div class="app-sub">P√§√§steameti Juhendi alusel (2023)</div>
</header>

<div id="view-rad" class="view-section active">
    
    <div class="sub-nav">
        <div class="sub-btn active" onclick="subTab('rules')">Ohutusreeglid</div>
        <div class="sub-btn" onclick="subTab('zones')">Tsoonid & Hinnang</div>
        <div class="sub-btn" onclick="subTab('calc')">Kalkulaator</div>
    </div>

    <div id="sub-rules" class="sub-content">
        
        <div class="card">
            <h3 style="margin-top:0; color:var(--rad)">‚ò¢Ô∏è P√µhireeglid (Peat√ºkk 6)</h3>
            
            <div class="rule-box border-red">
                <span class="rule-title" style="color:var(--danger)">SISENEMISKEELD > 100 mSv/h</span>
                <span class="rule-desc">Alasse ei tohi siseneda, v.a inimelu p√§√§stmiseks (max 30 min).</span>
            </div>

            <div class="rule-box border-yellow">
                <span class="rule-title" style="color:var(--rad)">Kaitsevarustus (6.3)</span>
                <span class="rule-desc">
                    ‚Ä¢ T√º√ºp 5 tolmukindel √ºlikond<br>
                    ‚Ä¢ Otsen√§iduga dosimeeter (kohustuslik)<br>
                    ‚Ä¢ Hingamiskaitse: P3 filter v√µi suru√µhuaparaat
                </span>
            </div>

            <div class="rule-box border-green">
                <span class="rule-title" style="color:var(--safe)">Saaste√§rastus (6.5)</span>
                <span class="rule-desc">
                    M√µ√µtepunkt turvaalalas (< 0,3 ¬µSv/h).<br>
                    <strong>< 1 ¬µSv/h:</strong> Puhas (v√µib koju saata pesema).<br>
                    <strong>> 1 ¬µSv/h:</strong> Vajab kohest saaste√§rastust.
                </span>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">Varustuse saastumine (6.10)</h3>
            <table class="data-table">
                <tr>
                    <td>Korduvkasutatav ohualas</td>
                    <td class="val" style="color:var(--safe)">1 - 10 ¬µSv/h</td>
                </tr>
                <tr>
                    <td>Ainult elup√§√§steks</td>
                    <td class="val" style="color:var(--warn)">10 - 100 ¬µSv/h</td>
                </tr>
                <tr>
                    <td>Isoleerida / Ohtlik</td>
                    <td class="val" style="color:var(--danger)">> 100 ¬µSv/h</td>
                </tr>
            </table>
        </div>

    </div>

    <div id="sub-zones" class="sub-content" style="display:none">
        
        <div class="card">
            <h3 style="margin-top:0">Ohuala raadiused (6.8.1)</h3>
            <p style="font-size:12px; color:#888">Esmane hinnang enne m√µ√µtmisi:</p>
            
            <table class="data-table">
                <tr>
                    <td>Vigastatud / Varjestamata allikas</td>
                    <td class="val" style="color:var(--danger)">50 m</td>
                </tr>
                <tr>
                    <td>Allika leke</td>
                    <td class="val" style="color:var(--danger)">100 m</td>
                </tr>
                <tr>
                    <td>Tulekahju / Plahvatus</td>
                    <td class="val" style="color:var(--danger)">400 m</td>
                </tr>
            </table>
        </div>

        <div class="card">
            <h3 style="margin-top:0">M√µ√µtmised</h3>
            <div class="rule-box border-red">
                <span class="rule-title">Ohuala piir</span>
                <span class="rule-desc">M√§√§ratakse doosikiirusel <strong>100 ¬µSv/h</strong> (6.8.3).</span>
            </div>
            <div class="rule-box border-yellow">
                <span class="rule-title">L√§henemine</span>
                <span class="rule-desc">Olukorda hinnata min 30m kauguselt. Ilma m√µ√µtjata l√§henemine keelatud.</span>
            </div>
        </div>
    </div>

    <div id="sub-calc" class="sub-content" style="display:none">
        <div class="card">
            <h3 style="margin-top:0; color:var(--rad)">√úhikute teisendaja</h3>
            <div style="display:flex; gap:10px">
                <input type="number" id="r-val" placeholder="0" oninput="calcRad()">
                <select id="r-unit" onchange="calcRad()">
                    <option value="uSv">¬µSv/h</option>
                    <option value="mSv">mSv/h</option>
                    <option value="R">R/h (Vana)</option>
                </select>
            </div>
            <div style="text-align:center; font-family:monospace; font-size:32px; color:var(--rad); margin:15px 0" id="rad-res">
                0 ¬µSv/h
            </div>
            <p style="font-size:11px; color:#666; text-align:center">1 R ‚âà 10 mSv = 10 000 ¬µSv</p>
        </div>

        <div class="card">
            <h3 style="margin-top:0">Viibimisaeg (Stay Time)</h3>
            <label style="font-size:12px; color:#aaa">Kiirgus tsoonis (¬µSv/h)</label>
            <input type="number" id="stay-rate" placeholder="nt 500000 (ehk 500 mSv)">
            
            <label style="font-size:12px; color:#aaa">Doosi limiit (mSv)</label>
            <input type="number" id="stay-limit" value="100" placeholder="Elup√§√§ste: 100">
            
            <button class="btn-action" onclick="calcStay()">Arvuta Aeg</button>
            <div id="stay-res" style="text-align:center; font-size:18px; font-weight:bold; margin-top:15px">--</div>
            <p style="font-size:11px; color:#666; text-align:center; margin-top:5px">Punkt 6.6.11: √úle 100 mSv/h max 30 min (ainult elup√§√§ste).</p>
        </div>
    </div>

</div>

<div id="view-chem" class="view-section">
    <div class="card">
        <input type="text" id="search" placeholder="Otsi ainet (UN, Nimi)..." oninput="filterChem()">
    </div>
    <div id="chem-list" class="card" style="padding:0">
        </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="switchMain('rad', this)">
        <span class="nav-icon">‚ò¢Ô∏è</span>Kiirgus
    </div>
    <div class="nav-item" onclick="switchMain('chem', this)">
        <span class="nav-icon">üß™</span>Keemia
    </div>
</div>

<script>
    // --- DATABASE (Example data - expand as needed) ---
    const chemDB = [
        {n: "Ammoniaak", un: "1005", k: "268", d: "M√ºrgine gaas"},
        {n: "Kloor", un: "1017", k: "268", d: "M√ºrgine, s√∂√∂vitav"},
        {n: "Bensiin", un: "1203", k: "33", d: "Tuleohtlik"},
        {n: "Propaan", un: "1978", k: "23", d: "Plahvatusohtlik gaas"}
    ];

    // --- LOGIC ---
    
    // Sub-tab switching
    function subTab(id) {
        document.querySelectorAll('.sub-content').forEach(el => el.style.display = 'none');
        document.getElementById('sub-' + id).style.display = 'block';
        
        document.querySelectorAll('.sub-btn').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
    }

    // Main View switching
    function switchMain(id, el) {
        document.querySelectorAll('.view-section').forEach(d => d.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    }

    // Radiation Converter
    function calcRad() {
        const val = parseFloat(document.getElementById('r-val').value);
        const unit = document.getElementById('r-unit').value;
        const res = document.getElementById('rad-res');

        if(isNaN(val)) { res.innerText = "0 ¬µSv/h"; return; }

        let uSv = 0;
        if(unit === 'uSv') uSv = val;
        if(unit === 'mSv') uSv = val * 1000;
        if(unit === 'R') uSv = val * 10000; 

        // Auto format
        let text = "";
        if(uSv < 1000) text = uSv.toFixed(1) + " ¬µSv/h";
        else if(uSv < 1000000) text = (uSv/1000).toFixed(2) + " mSv/h";
        else text = (uSv/1000000).toFixed(3) + " Sv/h";

        res.innerText = text;
    }

    // Stay Time Calc
    function calcStay() {
        const rate_uSv = parseFloat(document.getElementById('stay-rate').value);
        const limit_mSv = parseFloat(document.getElementById('stay-limit').value);
        const res = document.getElementById('stay-res');

        if(!rate_uSv || !limit_mSv) { res.innerText = "--"; return; }

        const rate_mSv = rate_uSv / 1000;
        const hours = limit_mSv / rate_mSv;
        const mins = Math.floor(hours * 60);

        if(mins < 60) res.innerText = mins + " minutit";
        else {
            const h = Math.floor(mins/60);
            const m = mins % 60;
            res.innerText = `${h}h ${m}min`;
        }
        
        if (mins > 30 && rate_uSv >= 100000) {
            res.innerHTML += "<br><span style='color:red; font-size:12px'>(NB! √úle 100 mSv/h on lubatud max 30 min!)</span>";
        }
    }

    // Chem Search
    const listEl = document.getElementById('chem-list');
    function renderChem(data) {
        listEl.innerHTML = "";
        data.forEach(i => {
            const div = document.createElement('div');
            div.className = 'chem-item';
            div.innerHTML = `<div class="chem-name">${i.n} <span class="chem-badge">UN ${i.un}</span></div><div class="chem-sub">${i.d} (Oht: ${i.k})</div>`;
            listEl.appendChild(div);
        });
    }
    
    function filterChem() {
        const q = document.getElementById('search').value.toLowerCase();
        const f = chemDB.filter(i => i.n.toLowerCase().includes(q) || i.un.includes(q));
        renderChem(f);
    }
    
    // Init
    renderChem(chemDB);

</script>
</body>
</html>
