<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CBRN Ultimate">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/144/biohazard.png">
    
    <title>CBRN Eesti Pro</title>
    <style>
        :root {
            --bg: #050505;
            --card: #18181b;
            --header: rgba(20, 20, 23, 0.95);
            --accent: #007AFF; /* System Blue */
            --danger: #FF3B30; /* Red */
            --warn: #FF9500;   /* Orange */
            --safe: #34C759;   /* Green */
            --rad: #FFD60A;    /* Yellow */
            --text: #F2F2F7;
            --subtext: #8E8E93;
            --border: #2C2C2E;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            padding-bottom: 100px;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* --- HEADER --- */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: var(--header);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 50px 20px 15px;
            border-bottom: 1px solid var(--border);
        }
        .app-title { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
        .app-sub { font-size: 13px; color: var(--subtext); font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }

        /* --- SEARCH --- */
        .search-wrap { margin-top: 15px; position: relative; }
        .search-input {
            width: 100%; background: #2C2C2E; border: none;
            padding: 12px 40px 12px 14px; border-radius: 12px;
            color: white; font-size: 17px; box-sizing: border-box; outline: none;
        }
        .search-icon { position: absolute; right: 12px; top: 12px; color: #888; }

        /* --- TABS --- */
        .view-section { display: none; padding: 20px 16px; animation: fadeUp 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CHEM CARDS --- */
        .chem-card {
            background: var(--card); border-radius: 16px; margin-bottom: 12px;
            padding: 16px; position: relative; overflow: hidden;
            border-left: 4px solid var(--subtext);
            transition: transform 0.2s;
        }
        .chem-card:active { transform: scale(0.98); background: #252528; }
        
        /* Danger Levels Colors */
        .lvl-tox { border-left-color: var(--danger); } /* Toxic Gas */
        .lvl-flam { border-left-color: var(--danger); } /* Flammable */
        .lvl-corr { border-left-color: var(--warn); }   /* Corrosive */

        .head-row { display: flex; justify-content: space-between; align-items: flex-start; }
        .chem-name { font-size: 18px; font-weight: 700; color: white; margin-bottom: 4px; }
        .chem-tags { display: flex; gap: 6px; }
        .tag { 
            font-size: 11px; font-family: monospace; font-weight: 700;
            padding: 4px 6px; border-radius: 6px; background: #333; color: #ccc;
        }
        .tag.un { background: var(--accent); color: white; }
        .tag.haz { border: 1px solid #555; }

        /* --- FULL DETAILS MODAL (OVERLAY) --- */
        #details-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 2000; overflow-y: auto;
            display: none; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .modal-header {
            position: sticky; top: 0; background: rgba(20,20,23,0.9);
            backdrop-filter: blur(20px); padding: 50px 20px 15px;
            border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
        }
        .close-btn { 
            background: #333; border: none; color: white; width: 32px; height: 32px; 
            border-radius: 50%; font-weight: bold; font-size: 18px;
        }

        /* --- VISUALIZER --- */
        .vis-container {
            width: 100%; height: 220px; background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            margin: 20px 0; border-radius: 16px; position: relative;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
            border: 1px solid #333;
        }
        .zone-label {
            position: absolute; color: rgba(255,255,255,0.5); font-size: 10px; text-transform: uppercase;
        }
        /* Dynamic Circles */
        .circle-hot {
            border-radius: 50%; background: rgba(255, 59, 48, 0.3); border: 2px dashed var(--danger);
            position: absolute; display: flex; justify-content: center; align-items: center;
            color: var(--danger); font-weight: bold; font-size: 12px;
            box-shadow: 0 0 30px rgba(255, 59, 48, 0.2);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .circle-evac {
            border-radius: 50%; background: rgba(255, 149, 0, 0.15); border: 1px solid var(--warn);
            position: absolute; z-index: 1;
            transition: all 0.5s ease;
        }
        .spill-point {
            width: 8px; height: 8px; background: white; border-radius: 50%; position: absolute; z-index: 10;
            box-shadow: 0 0 10px white;
        }

        /* --- DATA GRIDS --- */
        .info-block { padding: 0 20px 30px; }
        .sec-title { 
            font-size: 13px; text-transform: uppercase; color: var(--subtext); 
            margin: 25px 0 10px; font-weight: 600; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px;
        }
        .desc-text { font-size: 16px; line-height: 1.5; color: #ddd; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: var(--card); padding: 12px; border-radius: 10px; }
        .stat-lbl { font-size: 11px; color: var(--subtext); display: block; margin-bottom: 4px; }
        .stat-val { font-size: 16px; font-weight: 700; }
        
        .action-box { 
            background: rgba(52, 199, 89, 0.1); border-left: 3px solid var(--safe); 
            padding: 15px; border-radius: 8px; margin-top: 10px; font-size: 15px; line-height: 1.4;
        }

        /* --- RADIATION TOOLS --- */
        .rad-panel { background: #1c1c1e; padding: 20px; border-radius: 16px; margin-bottom: 20px; }
        .rad-display { 
            font-family: "Menlo", monospace; font-size: 36px; color: var(--rad); 
            text-align: center; margin: 15px 0; text-shadow: 0 0 10px rgba(255, 214, 10, 0.3);
        }
        input, select {
            width: 100%; padding: 14px; background: #2C2C2E; border: 1px solid #444;
            border-radius: 10px; color: white; font-size: 16px; margin-bottom: 10px; box-sizing: border-box;
        }
        .btn-calc {
            width: 100%; padding: 16px; background: var(--rad); color: black;
            font-weight: 800; border: none; border-radius: 12px; font-size: 16px;
        }

        /* --- NAV BAR --- */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(20,20,23,0.95);
            backdrop-filter: blur(20px); border-top: 1px solid var(--border);
            display: flex; padding-bottom: env(safe-area-inset-bottom); padding-top: 10px;
        }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 10px; }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 24px; margin-bottom: 4px; display: block; }

    </style>
</head>
<body>

<header>
    <div class="app-title">CBRN <span style="color:var(--accent)">PRO</span></div>
    <div class="app-sub">Eesti P√§√§ste ‚Ä¢ HAZMAT ‚Ä¢ KIIRGUS</div>
    
    <div class="search-wrap" id="search-bar-container">
        <input type="text" class="search-input" id="search" placeholder="Otsi: Nimi, UN, Ohu nr..." oninput="renderList()">
        <span class="search-icon">üîç</span>
    </div>
</header>

<div id="view-chem" class="view-section active">
    <div id="chem-list-container">
        </div>
</div>

<div id="view-rad" class="view-section">
    
    <div class="rad-panel">
        <h3 style="color:var(--rad); margin-top:0">√úhikute Teisendaja</h3>
        <div style="display:flex; gap:10px">
            <input type="number" id="r-val" placeholder="0" oninput="calcRad()">
            <select id="r-unit" onchange="calcRad()">
                <option value="uSv">¬µSv/h</option>
                <option value="mSv">mSv/h</option>
                <option value="R">R/h (R√∂ntgen)</option>
                <option value="Sv">Sv/h</option>
            </select>
        </div>
        <div class="rad-display" id="rad-res">0 ¬µSv/h</div>
    </div>

    <div class="rad-panel">
        <h3 style="color:white; margin-top:0">T√∂√∂aeg (Stay Time)</h3>
        <p style="color:#888; font-size:12px; margin-bottom:10px">Kui kaua tohib tsoonis viibida?</p>
        
        <label style="font-size:12px; color:#aaa">Kiirgus tsoonis (¬µSv/h)</label>
        <input type="number" id="stay-rate" placeholder="nt 500">
        
        <label style="font-size:12px; color:#aaa">Sinu doosi limiit (mSv)</label>
        <input type="number" id="stay-limit" placeholder="nt 50">
        
        <button class="btn-calc" onclick="calcStay()">ARVUTA AEG</button>
        <div id="stay-res" style="text-align:center; font-size:18px; font-weight:bold; margin-top:15px; color:white">--</div>
    </div>

    <div class="rad-panel">
        <h3 style="color:white; margin-top:0">Ohutu Kaugus (1/R¬≤)</h3>
        <input type="number" id="sq-i1" placeholder="Kiirgus punktis A">
        <div style="display:flex; gap:10px">
            <input type="number" id="sq-d1" placeholder="Kaugus A (m)">
            <input type="number" id="sq-d2" placeholder="Kaugus B (m)">
        </div>
        <button class="btn-calc" style="background:#444; color:white" onclick="calcSq()">Prognoosi</button>
        <div id="sq-res" style="text-align:center; margin-top:10px; color:#ccc">--</div>
    </div>
</div>

<div id="details-overlay">
    <div class="modal-header">
        <div>
            <div class="app-sub" style="margin:0" id="det-un">UN ----</div>
            <h1 style="margin:0; font-size:24px" id="det-name">Name</h1>
        </div>
        <button class="close-btn" onclick="closeDetails()">‚úï</button>
    </div>

    <div class="info-block">
        
        <div class="sec-title">OHUALA VISUALISEERING</div>
        <div class="vis-container">
            <div class="zone-label" style="top:10px; right:10px">Tuule suund ‚ûú</div>
            <div class="spill-point"></div>
            <div class="circle-evac" id="vis-evac"></div>
            <div class="circle-hot" id="vis-hot">
                <span id="vis-hot-text">-- m</span>
            </div>
        </div>
        <div style="text-align:center; font-size:12px; color:#666; margin-bottom:20px">
            *Punane: EOA (Hot Zone) ‚Ä¢ Oran≈æ: Evakuatsiooniala (Warm/Protection)
        </div>

        <div class="sec-title">DISTANTSID (Meetrid / Kilomeetrid)</div>
        <div class="grid-2">
            <div class="stat-box">
                <span class="stat-lbl">EOA (V√§ike leke)</span>
                <span class="stat-val" style="color:var(--danger)" id="d-iso-s">--</span>
            </div>
            <div class="stat-box">
                <span class="stat-lbl">EOA (Suur leke)</span>
                <span class="stat-val" style="color:var(--danger)" id="d-iso-l">--</span>
            </div>
            <div class="stat-box">
                <span class="stat-lbl">Evak (P√§ev/Suur)</span>
                <span class="stat-val" style="color:var(--warn)" id="d-evac-d">--</span>
            </div>
            <div class="stat-box">
                <span class="stat-lbl">Evak (√ñ√∂/Suur)</span>
                <span class="stat-val" style="color:var(--warn)" id="d-evac-n">--</span>
            </div>
        </div>

        <div class="sec-title">INFO & OHT</div>
        <div class="desc-text">
            <p><strong style="color:white">Kirjeldus:</strong> <span id="d-desc">--</span></p>
            <p><strong style="color:var(--danger)">Terviseoht:</strong> <span id="d-health">--</span></p>
        </div>

        <div class="sec-title">TEGEVUS & ESMAABI</div>
        <div class="action-box" id="d-action">--</div>
        
        <div style="height:50px"></div>
    </div>
</div>


<div class="nav-bar">
    <div class="nav-item active" onclick="switchView('chem', this)">
        <span class="nav-icon">üß™</span>Keemia
    </div>
    <div class="nav-item" onclick="switchView('rad', this)">
        <span class="nav-icon">‚ò¢Ô∏è</span>Kiirgus
    </div>
</div>

<script>
    /* * DATA BASE (50+ Substances)
     * un: UN Number
     * h: Hazard No (Ohu nr / Kemler)
     * n: Name
     * d: Description
     * x: Health Danger
     * a: Action / First Aid
     * rs/rl: Isolation Radius (Small/Large) in meters
     * edl/enl: Evacuation (Day Large / Night Large) in km
     * type: 'gas', 'liq', 'cwa' (for styling)
     */
    const db = [
        // GASES (TOXIC)
        {un:"1005", h:"268", n:"AMMONIAAK (Veevaba)", type:"gas", rs:30, rl:150, edl:0.8, enl:2.3, d:"V√§rvitu gaas, terav 'nuuskpiirituse' l√µhn. Kergem kui √µhk.", x:"S√∂√∂vitav silmadele, nahale ja kopsudele. Hingamisraskused. K√ºlmap√µletus vedelikuna.", a:"Veeudu gaasi sidumiseks. Mitte valada vett vedelikule! Happed neutraliseerivad."},
        {un:"1017", h:"268", n:"KLOOR", type:"gas", rs:60, rl:270, edl:1.6, enl:6.8, d:"Rohekaskollane gaas, terav ja √§rritav l√µhn. Raskem kui √µhk (vajub alla).", x:"Tugev oks√ºdeerija. P√µletab kopse, p√µhjustab turset (viivitusega).", a:"Veeudu hajutamiseks. Hapnik. T√§ielik hingamiskaitse (SCBA) kohustuslik."},
        {un:"1079", h:"268", n:"V√Ñ√ÑVELDIOKSIID", type:"gas", rs:30, rl:100, edl:0.8, enl:2.6, d:"V√§rvitu, terav 'p√µleva v√§√§vli' l√µhn. Raskem kui √µhk.", x:"√Ñrritab tugevalt hingamisteid. V√µib p√µhjustada l√§mbumist.", a:"Veeudu. V√§ltida kokkupuudet."},
        {un:"1053", h:"263", n:"VESINIKSULFIID", type:"gas", rs:30, rl:150, edl:1.2, enl:4.3, d:"V√§rvitu, m√§damuna l√µhn (suures kontsentratsioonis l√µhnataju kaob!).", x:"V√§ga m√ºrgine. R√ºndab n√§rvis√ºsteemi. Surm silmapilkne suurtes doosides.", a:"Mitte kasutada vett (reageerib). Tuulutada. Hapnik."},
        {un:"1076", h:"268", n:"FOSGEEN", type:"gas", rs:100, rl:600, edl:5.3, enl:11.0, d:"V√§rvitu gaas, kopitanud heina v√µi m√§danenud puuvilja l√µhn.", x:"Salakaval! Kopsuturse tekib 4-24h hiljem. L√§mbumine.", a:"T√§ielik puhkus kannatanule (isegi kui s√ºmptomeid pole). Soojendada."},
        {un:"1016", h:"263", n:"VINGUGAAS (CO)", type:"gas", rs:60, rl:150, edl:0.7, enl:2.2, d:"L√µhnatu, v√§rvitu, maitsetu gaas. P√µlemisj√§√§k.", x:"Seob veres hemoglobiini. Uimasus, teadvusekadu, surm.", a:"V√§rske √µhk. 100% Hapnik. Barokamber."},
        {un:"1050", h:"263", n:"VESINIKKLORIID (Gaas)", type:"gas", rs:30, rl:150, edl:1.8, enl:5.6, d:"V√§rvitu gaas, moodustab √µhus valge udu.", x:"S√∂√∂vitab k√µiki kudesid. Kopsuturse.", a:"Veeudu absorbeerib gaasi (tekib hape - ettevaatust!)."},
        {un:"1040", h:"263", n:"ET√úLEENOKSIID", type:"gas", rs:30, rl:150, edl:0.6, enl:2.5, d:"V√§rvitu gaas, magus eetri l√µhn. Tuleohtlik.", x:"Kantserogeenne. Keskn√§rvis√ºsteemi kahjustus.", a:"Suur kogus vett lahjendamiseks. V√§ltida s√§demeid."},
        
        // FLAMMABLE GASES
        {un:"1978", h:"23", n:"PROPAAN", type:"flam", rs:50, rl:100, edl:1.0, enl:1.0, d:"L√µhnatu (lisatud l√µhnaaine). Raskem kui √µhk - koguneb keldritesse.", x:"L√§mmatav (t√µrjub hapniku). Tule- ja plahvatusoht (BLEVE).", a:"Jahutada mahutit veega. Sulgeda leke kui v√µimalik. Mitte kustutada leeki enne sulgemist!"},
        {un:"1011", h:"23", n:"BUTAAN", type:"flam", rs:50, rl:100, edl:1.0, enl:1.0, d:"Sarnane propaanile. V√§lgumihkli gaas.", x:"Plahvatusoht. K√ºlmap√µletus.", a:"Jahutada. Evakueerida ala."},
        {un:"1001", h:"239", n:"ATSET√úLEEN", type:"flam", rs:100, rl:300, edl:1.5, enl:3.0, d:"K√º√ºslaugu l√µhnaga gaas.", x:"V√§ga ebastabiilne. V√µib plahvatada l√∂√∂gist v√µi kuumusest.", a:"Jahutada pikalt (24h+). Snaiperdamine (balloonid)."},
        {un:"1971", h:"23", n:"MAAGAAS (CNG/LNG)", type:"flam", rs:50, rl:100, edl:1.0, enl:1.0, d:"Metaan. Kergem kui √µhk.", x:"Plahvatusoht.", a:"Sulgeda kraanid. Tuulutada."},
        {un:"1049", h:"23", n:"VESINIK", type:"flam", rs:50, rl:100, edl:1.0, enl:1.0, d:"Kergem kui √µhk. V√§rvitu leek.", x:"Plahvatuspiirid v√§ga laiad.", a:"Jahutada. Ettevaatust - leeki ei ole p√§eval n√§ha!"},

        // ACIDS & LIQUIDS
        {un:"1789", h:"80", n:"SOOLHAPE", type:"liq", rs:30, rl:60, edl:0.2, enl:0.8, d:"V√§rvitu v√µi kollakas suitsev vedelik.", x:"Tugev s√∂√∂vitus. Aurud s√∂√∂vitavad kopse.", a:"Lubivesi, sooda neutraliseerimiseks. Suur kogus vett."},
        {un:"1830", h:"80", n:"V√Ñ√ÑVELHAPE", type:"liq", rs:30, rl:30, edl:0.1, enl:0.1, d:"√ïlijas, l√µhnatu vedelik. Akuhape.", x:"S√∂estab orgaanikat. Veega kokkupuutel keeb plahvatuslikult!", a:"MITTE LISADA VETT V√ÑIKSELE KOGUSELE! Liiv, tuhk, sooda."},
        {un:"2031", h:"885", n:"L√ÑMMASTIKHAPE (>70%)", type:"liq", rs:30, rl:60, edl:0.2, enl:0.9, d:"Suitsev punakaspruun vedelik.", x:"Tugev oks√ºdeerija (s√º√ºtab materjale). S√∂√∂vitav.", a:"Vesi suurtes kogustes. Eemaldu aurudest."},
        {un:"1790", h:"886", n:"VESINIKFLUORIIDHAPE (HF)", type:"liq", rs:60, rl:300, edl:1.5, enl:5.8, d:"V√§rvitu, suitsev.", x:"ERITI OHTLIK! Imendub l√§bi naha ja peatab s√ºdame (seob kaltsiumi). Valu puudub alguses.", a:"Kaltsiumgl√ºkonaat geel nahale KOHESELT. Haiglaravi."},
        
        // FLAMMABLE LIQUIDS
        {un:"1203", h:"33", n:"BENSIIN", type:"flam", rs:30, rl:60, edl:0.4, enl:0.6, d:"Iseloomulik l√µhn. Aurud raskemad kui √µhk.", x:"Narkootiline toime. Tuleoht.", a:"Vahtkustutus. V√§ltida kanalisatsiooni sattumist."},
        {un:"1202", h:"30", n:"DIISLIK√úTUS", type:"flam", rs:30, rl:30, edl:0.2, enl:0.2, d:"√ïlijas vedelik.", x:"Tuleoht. Libedus.", a:"Liiv, absorbent. Vaht."},
        {un:"1170", h:"33", n:"ETANOOL", type:"flam", rs:30, rl:30, edl:0.1, enl:0.1, d:"Alkohol.", x:"Tuleoht.", a:"Lahjendada veega. Alkoholikindel vaht."},
        
        // CWA (WARFARE)
        {un:"2810", h:"66", n:"SARIIN (GB)", type:"cwa", rs:60, rl:300, edl:2.1, enl:8.5, d:"N√§rvim√ºrk. Vedelikuna l√µhnatu, auruna puuviljane.", x:"Mioos (pupillid), krambid, ila, hingamisseiskus.", a:"Autoinjektor (Atropiin/Oksiim). Riiete eemaldamine. Pesu."},
        {un:"2810", h:"66", n:"VX AINE", type:"cwa", rs:30, rl:60, edl:0.2, enl:0.2, d:"√ïlijas vedelik. P√ºsib kaua maapinnal.", x:"Kontaktm√ºrk. V√§ga v√§ike doos on surmav.", a:"Kohene dekontaminatsioon (RSDL k√§sn). Atropiin."},
        {un:"2810", h:"66", n:"IPRIIT (HD)", type:"cwa", rs:30, rl:100, edl:0.6, enl:2.2, d:"Sinepigaas. L√µhn: sinep, k√º√ºslauk.", x:"Villid nahal, pimedus, kopsukahjustus. S√ºmptomid 4-12h hiljem.", a:"Pesu. S√ºmptomaatiline ravi."},
        {un:"1051", h:"663", n:"SINIHAPE (HCN)", type:"cwa", rs:30, rl:100, edl:0.5, enl:1.7, d:"M√µru mandli l√µhn.", x:"Blokeerib rakuhingamise. Kiire surm.", a:"Antidoot (Am√º√ºlnitrit)."},

        // OTHER TOXICS
        {un:"2312", h:"60", n:"FENOOL (Sula)", type:"liq", rs:30, rl:60, edl:0.2, enl:0.6, d:"Magus l√µhn. Valge kristalne v√µi vedelik.", x:"Imendub l√§bi naha kiiresti. Neerukahjustus.", a:"PEG-300 (Pol√ºet√ºleengl√ºkool) pesuks. Vesi."},
        {un:"1744", h:"886", n:"BROOM", type:"liq", rs:60, rl:200, edl:0.9, enl:3.4, d:"Raske punakaspruun vedelik.", x:"S√∂√∂vitab. Aurud v√§ga m√ºrgised.", a:"Soodalahus. Tiosulfaat."},
        {un:"2029", h:"886", n:"H√úDRASIIN", type:"liq", rs:30, rl:60, edl:0.6, enl:1.8, d:"Raketk√ºtus. L√µhn meenutab ammoniaaki.", x:"M√ºrgine, s√∂√∂vitav, tuleohtlik.", a:"Vaht. Vesi."},
        {un:"1092", h:"663", n:"AKROLEIIN", type:"liq", rs:60, rl:300, edl:1.5, enl:6.0, d:"K√µrbenud rasva l√µhn.", x:"√Ñ√§rmiselt √§rritav silmadele ja kopsudele.", a:"Vesi."},
        {un:"1614", h:"663", n:"VESINIKTS√úANIID (Stabiliseeritud)", type:"gas", rs:30, rl:100, edl:0.5, enl:1.7, d:"Vt Sinihape.", x:"Vt Sinihape.", a:"Antidoot."},
        {un:"1230", h:"336", n:"METANOOL", type:"flam", rs:30, rl:60, edl:0.2, enl:0.3, d:"Puu-piiritus.", x:"Joomisel pimedus ja surm. Tuleb kustutada alkoholivahuga.", a:"Etanool (antidoodina m√ºrgistusel)."},
        {un:"1090", h:"33", n:"ATSETOON", type:"flam", rs:30, rl:30, edl:0.1, enl:0.1, d:"K√º√ºnelakieemaldaja l√µhn.", x:"√Ñrritav, tuleohtlik.", a:"Vesi, vaht."},
        {un:"1547", h:"60", n:"ANILIIN", type:"liq", rs:30, rl:60, edl:0.1, enl:0.3, d:"√ïlijas, kalal√µhn.", x:"Verem√ºrk (ts√ºanoos).", a:"Pesu."},
        {un:"1824", h:"80", n:"NAATRIUMH√úDROKSIID", type:"liq", rs:30, rl:30, edl:0.1, enl:0.1, d:"Seebikivi.", x:"S√∂√∂vitab nahka libedaks (seebistab rasvu). Silmadele ohtlik.", a:"Pikk loputus veega (min 20 min)."},
        {un:"1805", h:"80", n:"FOSFORHAPE", type:"liq", rs:30, rl:30, edl:0.1, enl:0.1, d:"Siirupjas vedelik.", x:"S√∂√∂vitav.", a:"Vesi."},
        {un:"2078", h:"60", n:"TOLUEENDIISOTS√úANAAT", type:"liq", rs:30, rl:60, edl:0.3, enl:1.1, d:"Plastit√∂√∂stus.", x:"Astma, hingamisteede kahjustus.", a:"Vesi."},
        {un:"1613", h:"66", n:"H√úDROTS√úAANHAPE", type:"gas", rs:30, rl:100, edl:0.5, enl:1.7, d:"Vesilahus.", x:"V√§ga m√ºrgine.", a:"Vt Sinihape."},
        {un:"1993", h:"33", n:"P√ïLEV VEDELIK (N.O.S)", type:"flam", rs:30, rl:60, edl:0.3, enl:0.5, d:"Tundmatu.", x:"Tuli.", a:"Vaht."},
        {un:"1760", h:"80", n:"S√ñ√ñVITAV VEDELIK (N.O.S)", type:"liq", rs:30, rl:60, edl:0.2, enl:0.8, d:"Tundmatu hape/alus.", x:"S√∂√∂vitus.", a:"Testpaber. Vesi."},
        {un:"2811", h:"60", n:"M√úRGINE TAHKE AINE", type:"liq", rs:30, rl:60, edl:0.1, enl:0.2, d:"Pulber.", x:"Tolmu sissehingamine.", a:"Vesiudu tolmu sidumiseks."},
        {un:"1066", h:"26", n:"L√ÑMMASTIK", type:"gas", rs:30, rl:100, edl:0.1, enl:0.2, d:"Inertne gaas. Vedelana kr√ºogeenne.", x:"L√§mbumine (hapnikupuudus). K√ºlmap√µletus.", a:"Ventilatsioon."},
    ];

    /* --- DOM ELEMENTS --- */
    const chemList = document.getElementById('chem-list-container');
    const searchInput = document.getElementById('search');
    const overlay = document.getElementById('details-overlay');
    
    // Details Elements
    const dName = document.getElementById('det-name');
    const dUn = document.getElementById('det-un');
    const dIsoS = document.getElementById('d-iso-s');
    const dIsoL = document.getElementById('d-iso-l');
    const dEvacD = document.getElementById('d-evac-d');
    const dEvacN = document.getElementById('d-evac-n');
    const dDesc = document.getElementById('d-desc');
    const dHealth = document.getElementById('d-health');
    const dAction = document.getElementById('d-action');
    
    // Visualizer Elements
    const visHot = document.getElementById('vis-hot');
    const visHotText = document.getElementById('vis-hot-text');
    const visEvac = document.getElementById('vis-evac');

    /* --- RENDER LIST --- */
    function renderList() {
        const query = searchInput.value.toLowerCase();
        chemList.innerHTML = '';
        
        const filtered = db.filter(item => 
            item.n.toLowerCase().includes(query) || 
            item.un.includes(query) || 
            item.h.includes(query)
        );

        filtered.forEach(item => {
            // Style based on type
            let lvl = "";
            if(item.type === 'gas' || item.type === 'cwa') lvl = "lvl-tox";
            else if(item.type === 'flam') lvl = "lvl-flam";
            else lvl = "lvl-corr";

            const card = document.createElement('div');
            card.className = `chem-card ${lvl}`;
            card.onclick = () => openDetails(item);
            
            card.innerHTML = `
                <div class="head-row">
                    <div>
                        <div class="chem-name">${item.n}</div>
                        <div style="font-size:12px; color:#888">${item.d.substring(0,40)}...</div>
                    </div>
                    <div class="chem-tags">
                        <span class="tag haz">Ohu nr: ${item.h}</span>
                        <span class="tag un">UN ${item.un}</span>
                    </div>
                </div>
            `;
            chemList.appendChild(card);
        });
    }

    /* --- DETAILS & VISUALIZER LOGIC --- */
    function openDetails(item) {
        dName.innerText = item.n;
        dUn.innerText = `UN ${item.un} ‚Ä¢ Ohu nr ${item.h}`;
        
        // Data
        dIsoS.innerText = item.rs + " m";
        dIsoL.innerText = item.rl + " m";
        dEvacD.innerText = item.edl + " km";
        dEvacN.innerText = item.enl + " km";
        
        dDesc.innerText = item.d;
        dHealth.innerText = item.x;
        dAction.innerText = item.a;

        // Visualizer Animation
        // Reset styles
        visHot.style.width = '0px'; visHot.style.height = '0px';
        visEvac.style.width = '0px'; visEvac.style.height = '0px';
        visHotText.style.opacity = '0';
        
        overlay.style.display = 'block';

        // Animate
        setTimeout(() => {
            // Logic: Hot zone represents the core. Evac zone represents the large circle.
            // We scale visually for UI, not perfectly 1:1 map scale (as km vs m is too big diff)
            // Hot zone is always fixed relative size for visibility, Evac scales
            
            visHot.style.width = '80px'; 
            visHot.style.height = '80px';
            visHotText.innerHTML = `${item.rl} m`;
            visHotText.style.opacity = '1';

            // Scale evac circle based on Night Large distance (worst case)
            // Cap it so it doesn't explode the screen
            let size = Math.min(item.enl * 40 + 100, 300); // Abstract scaling
            visEvac.style.width = size + 'px';
            visEvac.style.height = size + 'px';
            
            // Offset Evac circle to show "Downwind" effect (shift right)
            visEvac.style.transform = `translateX(${size/4}px)`;
            
        }, 100);
    }

    function closeDetails() {
        overlay.style.display = 'none';
    }

    /* --- RADIATION CALCULATOR --- */
    function calcRad() {
        const val = parseFloat(document.getElementById('r-val').value);
        const unit = document.getElementById('r-unit').value;
        const res = document.getElementById('rad-res');

        if(isNaN(val)) { res.innerText = "0 ¬µSv/h"; return; }

        let uSv = 0;
        if(unit === 'uSv') uSv = val;
        if(unit === 'mSv') uSv = val * 1000;
        if(unit === 'R') uSv = val * 10000; // Approx
        if(unit === 'Sv') uSv = val * 1000000;

        let txt = "";
        if(uSv < 1000) txt = uSv.toFixed(1) + " ¬µSv/h";
        else if(uSv < 1000000) txt = (uSv/1000).toFixed(2) + " mSv/h";
        else txt = (uSv/1000000).toFixed(3) + " Sv/h";
        
        res.innerText = txt;
    }

    function calcStay() {
        const rate = parseFloat(document.getElementById('stay-rate').value); // uSv
        const limit = parseFloat(document.getElementById('stay-limit').value); // mSv
        const out = document.getElementById('stay-res');
        
        if(!rate || !limit) return;
        
        // Convert rate to mSv/h
        const rate_mSv = rate / 1000;
        const hours = limit / rate_mSv;
        const mins = Math.floor(hours * 60);
        
        if(mins < 60) out.innerText = mins + " minutit";
        else {
            const h = Math.floor(mins/60);
            const m = mins%60;
            out.innerText = `${h}h ${m}min`;
        }
    }

    function calcSq() {
        const i1 = parseFloat(document.getElementById('sq-i1').value);
        const d1 = parseFloat(document.getElementById('sq-d1').value);
        const d2 = parseFloat(document.getElementById('sq-d2').value);
        const res = document.getElementById('sq-res');
        
        if(!i1 || !d1 || !d2) return;
        const i2 = i1 * (d1*d1) / (d2*d2);
        res.innerText = `Tulemus: ${i2.toFixed(2)}`;
    }

    /* --- VIEW SWITCHER --- */
    window.switchView = function(view, el) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + view).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        
        // Header title change
        const t = document.querySelector('.app-title');
        if(view === 'chem') t.innerHTML = 'CBRN <span style="color:var(--accent)">PRO</span>';
        if(view === 'rad') t.innerHTML = 'KIIRGUS <span style="color:var(--rad)">ARVUTI</span>';
    }

    // Init
    renderList();

</script>
</body>
</html>
